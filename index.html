<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Nextera Enquête ouverte – Tableau de bord</title>
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="https://i.imgur.com/8XDJPhr.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- AmCharts Library -->
  <script src="https://cdn.amcharts.com/lib/5/index.js"></script>
  <script src="https://cdn.amcharts.com/lib/5/xy.js"></script>
  <script src="https://cdn.amcharts.com/lib/5/percent.js"></script>
  <script src="https://cdn.amcharts.com/lib/5/flow.js"></script>
  <script src="https://cdn.amcharts.com/lib/5/radar.js"></script>
  <script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>
  <script src="https://cdn.amcharts.com/lib/5/plugins/wordCloud.js"></script>

  <script src="https://cdn.amcharts.com/lib/5/map.js"></script>
  <script src="https://cdn.amcharts.com/lib/5/geodata/worldLow.js"></script>
  <script src="https://cdn.amcharts.com/lib/5/geodata/franceLow.js"></script>

  <style>
    :root {
      --primary: #8FD2D2;
      --dark: #0E3F2D;
      --accent: #15616D;
      --neutral: #A0A0A0;
      --bg-light: #F5F8FA;
      --sidebar-bg: #F0FAFC;
      --sidebar-border: #D0E6E6;
      --sidebar-width: 220px;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      display: flex;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: var(--bg-light);
    }

    .analysis-toggle {
      margin-top: 15px;
      background-color: #15616D;
      color: #fff;
      border: none;
      padding: 8px 14px;
      font-size: 14px;
      cursor: pointer;
      border-radius: 6px;
    }

    .analysis-content {
      display: none;
      margin-top: 15px;
      border-left: 4px solid #15616D;
      padding-left: 15px;
      animation: fadeIn 0.4s ease-in-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-5px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Enhanced Sidebar Styling */
    .sidebar {
      width: var(--sidebar-width);
      /* background: linear-gradient(135deg, #F8FDFD 0%, #F0FAFC 100%); */
      background: #FFFFFF;
      border-right: 1px solid var(--sidebar-border);
      color: var(--dark);
      padding: 0;
      min-height: 100vh;
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.05);
    }

    /* Logo Container */
    .sidebar .logo-container {
      padding: 30px 20px;
      text-align: center;
      background: linear-gradient(135deg, #ffffff 0%, #f8fdfd 100%);
      border-bottom: 1px solid #e6f3f3;
      margin-bottom: 20px;
    }

    .sidebar .logo-container img {
      width: 160px;
      height: auto;
      max-width: 100%;
      filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.1));
      transition: all 0.3s ease;
    }

    .sidebar .logo-container img:hover {
      transform: scale(1.02);
      filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.15));
    }

    /* Navigation Styling */
    .sidebar nav {
      padding: 0 20px;
    }

    .sidebar nav a {
      display: block;
      color: var(--dark);
      text-decoration: none;
      margin: 8px 0;
      font-weight: 500;
      font-size: 15px;
      padding: 12px 16px;
      border-radius: 8px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .sidebar nav a::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(143, 210, 210, 0.1), transparent);
      transition: left 0.5s ease;
    }

    .sidebar nav a:hover::before {
      left: 100%;
    }

    .sidebar nav a:hover {
      background-color: rgba(143, 210, 210, 0.1);
      transform: translateX(4px);
      box-shadow: 0 2px 8px rgba(143, 210, 210, 0.2);
    }

    .sidebar nav a.active {
      /* background: linear-gradient(135deg, #8FD2D2 0%, #7BCACA 100%); */
      background: #EBF3F5;
      /* color: white; */
      color: #003D46;
      box-shadow: 0 4px 12px rgba(143, 210, 210, 0.3);
      transform: translateX(2px);
    }

    .sidebar nav a.active:hover {
      /* background: linear-gradient(135deg, #7BCACA 0%, #6BC2C2 100%); */
      background: #c3d8dd;
      transform: translateX(6px);
    }

    /* Add some elegant spacing */
    .sidebar::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 20px;
      right: 20px;
      height: 1px;
      /* background: var(--dark); */
      /* background: linear-gradient(90deg, transparent, var(--sidebar-border), transparent); */
    }
    .content {
      flex: 1;
      padding: 20px;
      background-color: var(--bg-light);
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    header h1 {
      font-size: 24px;
      color: var(--dark);
    }
    header h4 {
      /* font-size: 24px; */
      color: var(--dark);
    }
    .filters {
      display: flex;
      gap: 10px;
    }
    .filters select {
      padding: 6px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
    /* .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
      gap: 20px;
    } */
    .grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr); /* ⬅️ 2 fixed columns */
      gap: 20px;
    }
    @media (max-width: 1000px) {
      .grid {
        grid-template-columns: 1fr; /* Stack on smaller screens */
      }
    }
    .grid-custom {
      display: grid;
      grid-template-columns: repeat(1, 1fr); /* ⬅️ 4 fixed columns */
      gap: 20px;
      width: 100%;
      max-width: 1000px;
      margin: 0 auto;
    }
    @media (max-width: 400px) {
      .grid-custom {
        grid-template-columns: 1fr; /* Stack on smaller screens */
      }
    }
    .grid0 {
      display: grid;
      grid-template-columns: repeat(4, 1fr); /* ⬅️ 4 fixed columns */
      gap: 20px;
      /* width: 100%;
      max-width: 500px;
      margin: 0 auto; */
    }
    @media (max-width: 400px) {
      .grid0 {
        grid-template-columns: 1fr; /* Stack on smaller screens */
      }
    }
    .grid0 > .chart-box:first-child {
      grid-column: span 3; /* Span 3 columns */
    }

    .grid0 > .chart-box:last-child {
      grid-column: span 1; /* Span 1 column */
    }
    .grid1 {
      display: grid;
      grid-template-columns: repeat(1, 1fr); /* ⬅️ 4 fixed columns */
      gap: 20px;
      width: 100%;
      max-width: 920px; /* Or any max width you like */
      margin: 0 auto;
    }
    @media (max-width: 400px) {
      .grid1 {
        grid-template-columns: 1fr; /* Stack on smaller screens */
      }
    }
     .grid2 {
      display: grid;
      grid-template-columns: repeat(4, 1fr); /* ⬅️ 4 fixed columns */
      gap: 20px;
    }
    @media (max-width: 1000px) {
      .grid2 {
        grid-template-columns: 1fr; /* Stack on smaller screens */
      }
    }
    .grid3 {
      display: grid;
      grid-template-columns: repeat(3, 1fr); /* ⬅️ 3 fixed columns */
      gap: 20px;
    }
    @media (max-width: 1000px) {
      .grid3 {
        grid-template-columns: 1fr; /* Stack on smaller screens */
      }
    }
    .grid4 {
      display: grid;
      grid-template-columns: repeat(1, 1fr); /* ⬅️ 4 fixed columns */
      gap: 20px;
      width: 100%;
      /* max-width: 1000px; */
      margin: 0 auto;
    }
    @media (max-width: 400px) {
      .grid4 {
        grid-template-columns: 1fr; /* Stack on smaller screens */
      }
    }
    .chart-box {
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.06);
    }
    .chart-box h3 {
      margin-bottom: 10px;
      font-size: 16px;
      color: var(--accent);
    }
    .chart-container {
      width: 100%;
      height: 450px;
    }
    .chart-grid-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      max-width: 100%;
      height: 700px;
      margin-top: 20px;
    }

    .chart-grid-item {
      width: 100%;
      height: 500px;
      position: relative;
    }
    #chart2.chart-container{
      height: 600px;
    }
    #chart4.chart-container{
      height: 450px;
    }
    .manual-legend {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px; /* Space between legend items */
      padding: 10px 0;
      flex-wrap: wrap; /* Allow wrapping on smaller screens */
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px; /* Space between color box and label */
    }

    .legend-color {
      width: 14px;
      height: 14px;
      border-radius: 2px; /* Slightly rounded corners for a polished look */
      display: inline-block;
    }

    .legend-label {
      font-size: 16px;
      color: #666666;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    }

    .manual-legend2 {
      display: flex;
      justify-content: flex-start; /* Align items to the left */
      align-items: center;
      gap: 20px;
      padding: 10px 0;
      flex-wrap: wrap;
      max-width: 800px; /* Controls the total width to maintain 2 items per row */
      margin: 0 auto;   /* Center the legend container itself on the page */
    }

    .legend-item2 {
      display: flex;
      align-items: center;
      gap: 8px;
      width: 30%;        /* Ensures 2 items fit per row with some gap */
      /* margin-bottom: 10px; */
    }

    .legend-color2 {
      width: 14px;
      height: 14px;
      border-radius: 2px;
      display: inline-block;
    }

    .legend-label2 {
      font-size: 16px;
      color: #666666;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    }

    #chart2.chart-grid-container {
      position: relative;
    }
    #chart4.chart-grid-container {
      position: relative;
    }
    #chart3.chart-container{
      height: 700px;
    }
    #chart6.chart-container {
      height: 480px;
    }
    #chart1.chart-container {
      height: 500px;
    }
    #chart5.chart-container{
      height: 700px;
    }
    #chart6 .company-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      /* justify-content: space-between; */
    }

    #chart6 .company-item {
      flex: 1 1 calc(25% - 10px);
      min-width: 80px;
      max-width: 150px;
      text-align: center;
      /* padding-bottom: 10px; */
    }
    /* #chart6 .company-item img {
      width: 100%;
      height: auto;
    } */

    .tabs {
      margin-bottom: 10px;
    }
    .tab-button {
      background-color: #ffffff;
      border: 1px solid #15616D;
      color: #15616D;
      padding: 5px 12px;
      margin-right: 5px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      transition: 0.3s;
    }
    .tab-button:hover {
      background-color: #15616D;
      color: #fff;
    }
    .tab-button.active {
      background-color: #15616D;
      color: #fff;
    }

    .tab-button3 {
      background-color: #ffffff;
      border: 1px solid #15616D;
      color: #15616D;
      padding: 5px 12px;
      margin-right: 5px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      transition: 0.3s;
    }
    .tab-button3:hover {
      background-color: #15616D;
      color: #fff;
    }
    .tab-button3.active {
      background-color: #15616D;
      color: #fff;
    }

    .tab-button4 {
      background-color: #ffffff;
      border: 1px solid #15616D;
      color: #15616D;
      padding: 5px 12px;
      margin-right: 5px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      transition: 0.3s;
    }
    .tab-button4:hover {
      background-color: #15616D;
      color: #fff;
    }
    .tab-button4.active {
      background-color: #15616D;
      color: #fff;
    }

    .tab-button5 {
      background-color: #ffffff;
      border: 1px solid #15616D;
      color: #15616D;
      padding: 5px 12px;
      margin-right: 5px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      transition: 0.3s;
    }
    .tab-button5:hover {
      background-color: #15616D;
      color: #fff;
    }
    .tab-button5.active {
      background-color: #15616D;
      color: #fff;
    }

    .tab-button6 {
      background-color: #ffffff;
      border: 1px solid #15616D;
      color: #15616D;
      padding: 5px 12px;
      margin-right: 5px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      transition: 0.3s;
    }
    .tab-button6:hover {
      background-color: #15616D;
      color: #fff;
    }
    .tab-button6.active {
      background-color: #15616D;
      color: #fff;
    }


    .status-grid-rowed {
      display: flex;
      flex-direction: column;
      gap: 14px;
      margin-top: 20px;
    }

    .status-row {
      display: grid;
      grid-template-columns: 200px repeat(4, 1fr); /* 1 for label, 4 for ES values */
      gap: 10px;
      align-items: center;
    }

    .status-category {
      font-weight: bold;
      font-size: 15px;
      color: #15616D;
    }

    .status-value {
      background-color: #f5f7fa;
      padding: 10px;
      text-align: center;
      border-radius: 8px;
      font-size: 14px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
      font-weight: 500;
    }

    .status-value-title {
      /* background-color: #f5f7fa; */
      padding: 10px;
      text-align: center;
      /* border-radius: 8px; */
      font-size: 14px;
      /* box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08); */
      font-weight: 500;
    }


    /* Category Colors */
    .emploi {
      background-color: #E6F0F9;
      border-left: 4px solid #457B9D;
    }
    .recherche {
      background-color: #FAF2E6;
      border-left: 4px solid #D69B5A;
    }
    .etudes {
      background-color: #E6F7F4;
      border-left: 4px solid #2A9D8F;
    }
    .inactif {
      background-color: #F9E9EC;
      border-left: 4px solid #A77A82;
    }
    .non {
      background-color: #f7e6f9;
      border-left: 4px solid #8d459d;
    }

    .map-container {
      width: 600px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      padding: 20px;
    }
    h2 {
      text-align: center;
      margin-bottom: 10px;
    }
    svg {
      width: 100%;
      height: auto;
    }
    .region:hover {
      stroke: #000;
      stroke-width: 1.5px;
      cursor: pointer;
    }


    .chart-content {
      display: flex;
      gap: 20px;
      align-items: flex-start;
    }

    .region-list {
      flex: 0 0 200px; /* Fixed width for the list */
      font-size: 14px;
    }

    #pieChartTopSalariesLegend {
      margin-top: 10px;
      display: flex;
      justify-content: flex-start;
      flex-direction: column;
      align-items: stretch;
      font-family: Arial, sans-serif;
    }

    #chartdivSankee {
      width: 100%;
      height: 500px;
    }
  </style>
</head>
<body>

  <aside class="sidebar">
    <div class="logo-container">
      <img src="https://i.imgur.com/CNq3MUN.png" alt="Nextera Logo">
    </div>
    <nav>
      <a href="#" class="active">Tableau de bord</a>
      <!-- Add more navigation items as needed -->
    </nav>
  </aside>
  <main class="content">
    <header>
      <h1>RDC 2022 - Enquêtes d'Employabilité</h1>
      <h4>EE1 : Certification &nbsp;| &nbsp;

      <!-- </h4> -->
      <!-- <h4> -->
        EE2 : Après 6 mois &nbsp;| &nbsp;

      <!-- </h4> -->
      <!-- <h4> -->
        EE3 : Après 12 mois &nbsp;| &nbsp;

      <!-- </h4> -->
      <!-- <h4> -->
        EE4 : Après 24 mois

      </h4>
      <!-- <div class="filters">
        <label for="cohort">Cohort:</label>
        <select id="cohort">
          <option value="2022">2022</option>
          <option value="2023" selected>2023</option>
          <option value="2024">2024</option>
        </select>
      </div> -->
    </header>

    <div class="grid3" style="margin-bottom: 20px;">
      <div class="chart-box" style="text-align: center; background-color: rgb(226, 246, 250);">
        <h3 style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 18px; font-weight: 600; color: #00454D	; margin-bottom: 10px;"><strong>Poursuite d’étude à 6 mois après la certification</strong></h3>
        <p style="color:#1E9180 ; font-size: 40px;"><strong>57%</strong></p>
        <!-- <p style="color:#49928a; padding-bottom: 25px;"><strong>27% (Basé sur EE2)</strong></p> -->
      </div>

      <div class="chart-box" style="text-align: center; background-color: rgb(226, 250, 233);">
        <h3 style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 18px; font-weight: 600; color: #00454D	; margin-bottom: 10px;"><strong>Domaine de Poursuite d'études</strong></h3>
        <!-- <p style="padding-top: 10px; color: #1E9180 "><strong><span style="color:#2C8B7D	;"> 56%  </span></strong></p> -->
        <table style="margin: 0 auto; text-align: center;"><thead>
          <tr style="font-size: 15px; color: #6B7280 ">
            <th style="padding-left: 15px;">Immobilier</th>
            <th style="padding-left: 15px;">Commerce</th>
            <th style="padding-left: 15px;">Banque / Assurance</th>
          </tr></thead>
        <tbody>
          <tr style="font-size: 18px; color: #159E8E">
            <td><strong>27%</strong></td>
            <td><strong>5%</strong></td>
            <td><strong>4%</strong></td>
          </tr>
        </tbody>
        </table>
        <!-- <p style="color:#49928a; padding-bottom: 25px;"><strong>27% (Basé sur EE2)</strong></p> -->
      </div>

      <div class="chart-box" style="text-align: center; background-color: rgb(250, 239, 226);">
        <h3 style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 18px; font-weight: 600; color: #00454D	; margin-bottom: 10px;"><strong>Niveau TOP cible BAC+5</strong></h3>
        <p style="color:#1E9180 ; font-size: 40px;"><strong>80%</strong></p>
        <!-- <p style="color:#49928a; padding-bottom: 25px;"><strong>27% (Basé sur EE2)</strong></p> -->
      </div>
    </div>

    <hr style="border: none; border-top: 2px solid #D0E6E6; margin: 30px 0;">

    <div class="grid2" style="margin-bottom: 20px;">
      <div class="chart-box" style="text-align: center;">
        <h3 style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 18px; font-weight: 600; color: #00454D	; margin-bottom: 10px;"><strong>Postes</strong></h3>
        <p style="color: #1E9180 "><strong>Postes ciblés après 24 mois :<span style="color:#2C8B7D	;"> 75%  </span></strong></p>
        <table style="margin: 0 auto; text-align: center;"><thead>
          <tr style="font-size: 15px;">
            <th style="padding-left: 15px;">EE1</th>
            <th style="padding-left: 15px;">EE2</th>
            <th style="padding-left: 15px;">EE3</th>
            <th style="padding-left: 15px;">EE4</th>
          </tr></thead>
        <tbody>
          <tr style="font-size: 13px; color: #159E8E;">
            <td style="padding-left: 15px; font-weight: 700;">0%</td>
            <td style="padding-left: 15px; font-weight: 700;">74%</td>
            <td style="padding-left: 15px; font-weight: 700;">82%</td>
            <td style="padding-left: 15px; font-weight: 700;">75%</td>
          </tr>
        </tbody>
        </table>
        <!-- <p style="color:#49928a; padding-bottom: 25px;"><strong>27% (Basé sur EE2)</strong></p> -->
      </div>

      <div class="chart-box" style="text-align: center;">
        <h3 style="text-align: center; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 18px; font-weight: 600; color: #00454D; margin-bottom: 10px;"><strong>Domaines</strong></h3>
        <p style="color: #1E9180 "><strong>Domaines ciblés après 24 mois :<span style="color:#49928a;"> 97%  </span></strong></p>
        <table style="margin: 0 auto; text-align: center;"><thead>
          <tr style="font-size: 15px;">
            <th style="padding-left: 15px;">EE1</th>
            <th style="padding-left: 15px;">EE2</th>
            <th style="padding-left: 15px;">EE3</th>
            <th style="padding-left: 15px;">EE4</th>
          </tr></thead>
        <tbody>
          <tr style="font-size: 13px; color: #159E8E">
            <td style="padding-left: 15px; font-weight: 700;">0%</td>
            <td style="padding-left: 15px; font-weight: 700;">71%</td>
            <td style="padding-left: 15px; font-weight: 700;">85%</td>
            <td style="padding-left: 15px; font-weight: 700;">97%</td>
          </tr>
        </tbody>
        </table>
      </div>

      <div class="chart-box" style="text-align: center;">
        <h3 style="text-align: center; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 18px; font-weight: 600; color: #00454D; margin-bottom: 10px;"><strong>Salaires</strong></h3>
        <p style="color: #1E9180"><strong>Salaires ciblés après 24 mois :<span style="color:#49928a;"> 5% </span></strong></p>
        <table style="margin: 0 auto; text-align: center;"><thead>
          <tr style="font-size: 15px;">
            <th style="padding-left: 15px;">EE1</th>
            <th style="padding-left: 15px;">EE2</th>
            <th style="padding-left: 15px;">EE3</th>
            <th style="padding-left: 15px;">EE4</th>
          </tr></thead>
        <tbody>
          <tr style="font-size: 13px; color: #159E8E">
            <td style="padding-left: 15px; font-weight: 700;">0%</td>
            <td style="padding-left: 15px; font-weight: 700;">5%</td>
            <td style="padding-left: 15px; font-weight: 700;">4%</td>
            <td style="padding-left: 15px; font-weight: 700;">5%</td>
          </tr>
        </tbody>
        </table>
      </div>

      <div class="chart-box">
        <h3 style="text-align: center; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 18px; font-weight: 600; color: #00454D; margin-bottom: 10px;"><strong>Compétences</strong></h3>
        
        <!-- Optional: Show a placeholder or small summary -->
        <p style="text-align: center; color: #1E9180; font-weight: 500;"><span><strong>60%</strong></span> des compétences ciblées sont utlisées.</p>
        <table style="margin: 0 auto; text-align: center;"><thead>
          <tr style="font-size: 15px;">
            <th style="padding-left: 15px;">EE1</th>
            <th style="padding-left: 15px;">EE2</th>
            <th style="padding-left: 15px;">EE3</th>
            <th style="padding-left: 15px;">EE4</th>
          </tr></thead>
        <tbody>
          <tr style="font-size: 13px; color: #159E8E">
            <td style="padding-left: 15px; font-weight: 700;">0%</td>
            <td style="padding-left: 15px; font-weight: 700;">54%</td>
            <td style="padding-left: 15px; font-weight: 700;">63%</td>
            <td style="padding-left: 15px; font-weight: 700;">60%</td>
          </tr>
        </tbody>
        </table>
        <!-- <button class="analysis-toggle" onclick="toggleAnalysis('chart-final-analysis')" style="margin-top: 10px;">Afficher/Masquer l’analyse</button>

        <div id="chart-final-analysis" class="analysis-content" style="display: none; margin-top: 20px; font-size: 15px; line-height: 1.6; color: #333;">
          
          <h4 style="color: #15616D; margin-bottom: 10px;">🔍 Analyse</h4>
          <ul style="padding-left: 20px;">
            <li><strong>Postes visés :</strong> les diplômés ciblent des métiers à forte valeur ajoutée tels que chef de projet, analyste data, consultant, ou product owner.</li>
            <li><strong>Secteurs dynamiques :</strong> IT, finance, conseil, et industrie dominent les intentions, montrant une bonne orientation vers des secteurs en croissance.</li>
            <li><strong>Salaires ciblés :</strong> une majorité vise la tranche <strong>1 900€ à 2 199€</strong> à partir d’EE2, avec un pic à 17% à EE3.</li>
          </ul>

          <h4 style="color: #15616D; margin: 20px 0 10px;">🛠️ Recommandation</h4>
          <ol style="padding-left: 20px;">
            <li><span style="color: #2e7d32;"><strong>Aligner la formation</strong></span> avec les besoins du marché en renforçant les compétences clés des secteurs porteurs.</li>
            <li><span style="color: #2e7d32;"><strong>Renforcer le suivi post-formation</strong></span> (coaching, réseau, accompagnement) pour convertir les intentions en opportunités concrètes.</li>
          </ol>
        </div> -->
      </div>



    </div>

    <div class="grid1" style="margin-bottom: 20px;">
      <div class="chart-box" style="background-color: #f5e8d5;">
        <h3 style="text-align: center; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 18px; font-weight: 600; color: #00454D; margin-bottom: 10px;"><strong>Analyse</strong></h3>
        
        <!-- Optional: Show a placeholder or small summary -->
        <p style="text-align: center; color: #1E9180; font-weight: 500;">Contribution du programme RDC à l’employabilité des diplômés.</p>
        <button class="analysis-toggle" onclick="toggleAnalysis('chart-final-analysis')"   style="margin: 10px auto 0 auto; display: block;">Afficher/Masquer l’analyse</button>

        <div id="chart-final-analysis" class="analysis-content" style="display: none; margin-top: 20px; font-size: 15px; line-height: 1.6; color: #333;">
          
          <h4 style="color: #15616D; margin-bottom: 10px;">🔍 Analyse</h4>
          <ul style="padding-left: 20px;">
            <li><strong>Postes visés :</strong> les diplômés ciblent des métiers à forte valeur ajoutée tels que chef de projet, analyste data, consultant, ou product owner.</li>
            <li><strong>Secteurs dynamiques :</strong> IT, finance, conseil, et industrie dominent les intentions, montrant une bonne orientation vers des secteurs en croissance.</li>
            <li><strong>Salaires ciblés :</strong> une majorité vise la tranche <strong>1 900€ à 2 199€</strong> à partir d’EE2, avec un pic à 17% à EE3.</li>
          </ul>

          <h4 style="color: #15616D; margin: 20px 0 10px;">🛠️ Recommandation</h4>
          <ol style="padding-left: 20px;">
            <li><span style="color: #2e7d32;"><strong>Aligner la formation</strong></span> avec les besoins du marché en renforçant les compétences clés des secteurs porteurs.</li>
            <li><span style="color: #2e7d32;"><strong>Renforcer le suivi post-formation</strong></span> (coaching, réseau, accompagnement) pour convertir les intentions en opportunités concrètes.</li>
          </ol>
        </div>
      </div>
    </div>

    <div class="grid" style="margin-bottom: 20px;">
      <div class="chart-box" style="text-align: center;">
        <h3 style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 18px; font-weight: 600; color: #00454D; margin-bottom: 10px;"><strong>Les 3 premiers postes</strong></h3>
        <div id="pieChart" style="width: 100%; height: 300px;"></div>
        <!-- <p style="padding-top: 10px;"><strong>Conseiller commercial<span style="color:#49928a;"> 17%</span></strong></p>
        <p><strong>Commercial<span style="color:#49928a;"> 14%</span></strong></p>
        <p><strong>Responsable des ventes<span style="color:#49928a;"> 4%</span></strong></p> -->
        <!-- <p style="color:#49928a; padding-bottom: 25px;"><strong>27% (Basé sur EE2)</strong></p> -->
      </div>

      <div class="chart-box" style="text-align: center;">
        <h3 style="text-align: center; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 18px; font-weight: 600; color: #00454D; margin-bottom: 10px;"><strong>Les 3 principaux domaines</strong></h3>
        <div id="domainePieChart" style="width: 100%; height: 300px; margin: auto;"></div>
        <!-- <p style="padding-top: 10px;"><strong>Immobilier <span style="color:#49928a;"> 22%</span></strong></p>
        <p><strong>Commerce<span style="color:#49928a;"> 6%</span></strong></p>
        <p><strong>Assurance<span style="color:#49928a;"> 4%</span></strong></p> -->
      </div>

      <div class="chart-box" style="text-align: center;">
        <h3 style="text-align: center; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 18px; font-weight: 600; color: #00454D; margin-bottom: 10px;"><strong>Fourchette salariale moyenne</strong></h3>
        <p style="padding-top: 20px;"><strong>1 600€ – 1 899€</strong></p>
        <p style="color:#49928a; padding-bottom: 25px; font-size: 20px;"><strong>39%</strong></p>
      </div>

      <div class="chart-box" style="text-align: center;">
        <h3 style="text-align: center; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 18px; font-weight: 600; color: #00454D; margin-bottom: 10px;"><strong>Taux de satisfaction de la formation</strong></h3>
        <p style="padding-top: 10px; color:#1E9180 ; font-size: 40px;"><strong>73%</strong></p>
        <!-- <p style="color:#49928a; padding-bottom: 25px;"><strong>72.68%</strong></p> -->
      </div>
    </div>

    <hr style="border: none; border-top: 2px solid #D0E6E6; margin: 30px 0;">
   
    <div class="grid" style="margin-bottom: 20px;">
      <div class="chart-box">
        <h3>Effectif & Taux de succès à certification</h3>
        <div class="legend-item">
          <span class="legend-color" style="background-color: #8f8f8f;"></span>
          <span class="legend-label">Nombre total d'étudiants : <strong>383</strong></span>
        </div>
        <div id="pieChartA" class="chart-container" style="height: 300px;"></div>
      </div>

      <div class="chart-box">
        <h3>Distribution des enquêtes par vague</h3>
        <div id="chartSent" class="chart-container" style="height: 400px;"></div>
      </div>

      <div class="chart-box">
        <h3>Ouvert – Commencé – Enquête complétée (EE1–EE4)</h3>
        <div id="chart1" class="chart-container"></div>
        <button class="analysis-toggle" onclick="toggleAnalysis('chart1-analysis')">Afficher/Masquer l’analyse</button>
        <div id="chart1-analysis" class="analysis-content" style="margin-top: 20px; font-size: 15px; line-height: 1.6; color: #333;">
          <h4 style="color: #15616D; margin-bottom: 10px;">🔍 Analyse</h4>
          <ul style="padding-left: 20px;">
            <li><strong>Baisse significative de la participation :</strong> le nombre de réponses passe de 318 à l’EE1 à seulement 104 à l’EE4, montrant un désengagement progressif.</li>
            <li><strong>Complétion stable chez les engagés :</strong> une fois le questionnaire commencé, les anciens le terminent presque toujours (97 % à l’EE2, 98 % à l’EE3, 96 % à l’EE4).</li>
            <li><strong>Taux d’ouverture en baisse constante :</strong> les ouvertures d’e-mails chutent de 318 à 108, ce qui peut indiquer une perte d’intérêt ou des problèmes de délivrabilité.</li>
            <li><strong>Écart net après l’EE1 :</strong> entre EE1 et EE2, toutes les métriques chutent de plus de 50 %, confirmant que l’EE1 est un cas particulier (lié à la remise de diplôme).</li>
          </ul>

          <h4 style="color: #15616D; margin: 20px 0 10px;">🛠️ Recommandations</h4>
          <ol style="padding-left: 20px;">
            <li><strong>Segmenter les publics selon leur engagement</strong> et envoyer des messages adaptés (ex. : “Vous nous manquez, [Prénom] !” pour les non-répondants).</li>
            <li><strong>Renforcer les relances</strong> : prévoir 2 à 3 rappels avec des objets personnalisés ou des tons variés.</li>
            <li><strong>Raccourcir davantage le questionnaire</strong> : viser moins de 3 minutes pour limiter les abandons, surtout aux vagues EE3/EE4.</li>
            <li><strong>Proposer des incitations attrayantes</strong> : ex. : tirages au sort, certificats ou mises en avant d’anciens participants.</li>
            <li><strong>Optimiser le format mobile</strong> : s’assurer que les e-mails et formulaires soient parfaitement lisibles et utilisables sur smartphone.</li>
            <li><strong>Mobiliser l’influence des pairs</strong> : intégrer des messages ou vidéos d’anciens élèves ou d’enseignants pour motiver davantage.</li>
          </ol>
        </div>
      </div>

      <div class="chart-box">
        <h3 id="chart6-title">Les 8 premières entreprises</h3>
        <div class="tabs">
          <button class="tab-button6" data-tab="EE1">EE1</button>
          <button class="tab-button6 active" data-tab="EE2">EE2</button>
          <button class="tab-button6" data-tab="EE3">EE3</button>
          <button class="tab-button6" data-tab="EE4">EE4</button>
        </div>
        <div id="chart6" class="chart-container"></div>
        <button class="analysis-toggle" onclick="toggleAnalysis('chart6-analysis')">Afficher/Masquer l’analyse</button>
        <div id="chart6-analysis" class="analysis-content">
          <h4 style="color: #15616D; margin: 30px 0 10px;">🔍 Analyse</h4>
          <ul style="padding-left: 20px;">
            <li><strong>Décathlon, Orange, Société Générale :</strong> Employeurs récurrents visibles dans toutes les vagues.</li>
            <li><strong>Secteurs forts :</strong> Distribution et banque/assurance (Carrefour, AXA, Société Générale).</li>
            <li><strong>Catégorie “Autre” importante :</strong> Beaucoup de diplômés en dehors du top 8 entreprises.</li>
            <li><strong>Présence régulière d’employeurs :</strong> Indice de relations fortes ou d’intérêt récurrent pour le profil diplômé.</li>
          </ul>

          <h4 style="color: #15616D; margin: 20px 0 10px;">🛠️ Recommandations</h4>
          <ol style="padding-left: 20px;">
            <li><strong>Renforcer les relations entreprises :</strong> Avec les groupes majeurs (ex : AXA, Orange, Decathlon).</li>
            <li><strong>Explorer les recruteurs “Autres” :</strong> Mieux comprendre et identifier ces structures.</li>
            <li><strong>Mettre en valeur les employeurs partenaires :</strong> Dans les communications institutionnelles.</li>
            <li><strong>Segmenter les entreprises :</strong> Pour mieux cibler l'accompagnement par secteur.</li>
          </ol>
        </div>
      </div>
    </div>

    <div class="grid0" style="margin-bottom: 20px;">
      <div class="chart-box">
        <h3 style="text-align: center; font-size: 24px;">Étudiants par région</h3><br>
        <div id="container" style="display: flex; align-items: flex-start; gap: 20px;">
          <div id="studentsLegend" style="width: 350px;"></div>
          <div id="studentsChart" style="flex-grow: 1; height: 450px;"></div>
        </div>
      </div>

      <div class="chart-box">
        <h3 style="text-align: center; font-size: 24px;">Répartition par genre</h3><br>
        <div class="legend-item">
          <span class="legend-color" style="background-color: #67b7dc;"></span>
          <span class="legend-label">Homme <span style="color: #67b7dc"><strong>44%</strong></span></span>
        </div>
        <div class="legend-item">
          <span class="legend-color" style="background-color: #6794dc;"></span>
          <span class="legend-label">Femme <span style="color: #6794dc"><strong>56%</strong></span></span>
        </div>
        <div id="pieChartGender" class="chart-container" style="height: 400px;"></div>
        <!-- <div id="pieChartGenderLegend" style="margin-top: 10px;"></div> -->
      </div>
    </div>

    <!-- <div class="grid-custom" style="margin-bottom: 20px;">
      <div class="chart-box">
        <h3 style="text-align: center; font-size: 24px;">Salaire moyen par région (€)</h3><br>
        <div id="containerSalary" style="display: flex; align-items: flex-start; gap: 20px;">
          <div id="salaryLegend" style="width: 350px;"></div>
          <div id="salaryChart" style="flex-grow: 1; height: 450px;"></div>
        </div>
      </div>
    </div> -->

    <div class="grid0" style="margin-bottom: 20px;">
      <div class="chart-box">
        <h3 style="text-align: center; font-size: 24px;">Salaire moyen par région (€)</h3><br>
        <div id="containerSalary" style="display: flex; align-items: flex-start; gap: 20px;">
          <div id="salaryLegend" style="width: 400px;"></div>
          <div id="salaryChart" style="flex-grow: 1; height: 500px;"></div>
        </div>
      </div>

      <div class="chart-box">
        <h3 style="text-align: center; font-size: 24px;">Niveau managérial</h3>
        <div class="manual-legend">
          <!-- <div class="legend-item">
            <span class="legend-color" style="background-color: #A77A82;"></span>
            <span class="legend-label">Oui</span>
          </div> -->
          <div class="legend-item">
            <span class="legend-color" style="background-color: #2A9D8F;"></span>
            <span class="legend-label">Ayant un poste de Manager</span>
          </div>
        </div>
        <div id="chart4" style="width: 100%; height: 300px;"></div>

        <button style="margin-top: 140px;" class="analysis-toggle" onclick="toggleAnalysis('chart4-analysis')">Afficher/Masquer l’analyse</button>
        <div id="chart4-analysis" class="analysis-content" style="margin-top: 20px; font-size: 15px; line-height: 1.6; color: #333;">
          <h4 style="color: #15616D; margin: 30px 0 10px;">🔍 Analyse</h4>
          <ul style="padding-left: 20px;">
            <li><strong>Nombre croissant de managers :</strong> de 20 à 30 entre EE2 et EE4.</li>
            <li><strong>Progression constante :</strong> environ +5 à chaque vague.</li>
            <li><strong>Encore une minorité :</strong> seulement 25 % environ sont managers à EE4.</li>
            <li><strong>Mobilité ascendante :</strong> le programme semble favoriser l’évolution de carrière.</li>
          </ul>

          <h4 style="color: #15616D; margin: 20px 0 10px;">🛠️ Recommandations</h4>
          <ol style="padding-left: 20px;">
            <li><strong>Partager des parcours inspirants :</strong> anciens élèves devenus managers.</li>
            <li><strong>Mettre en avant la progression :</strong> sous forme graphique ou comparative.</li>
            <li><strong>Offrir un accompagnement au leadership :</strong> coaching, mentorat ou formations.</li>
            <li><strong>Utiliser dans la communication :</strong> pour démontrer l’impact long terme du diplôme.</li>
          </ol>
        </div>

      </div>
    </div>

    <div class="grid" style="margin-bottom: 20px;">
      <div class="chart-box">
        <h3>Statut Professionnel : Situation après la certification</h3>
        <div class="status-grid-rowed">
          <div class="status-row" style="color: #00454D">
            <div class="status-category"></div>
            <div class="status-value-title"><strong>EE1</strong></div>
            <div class="status-value-title"><strong>EE2</strong></div>
            <div class="status-value-title"><strong>EE3</strong></div>
            <div class="status-value-title"><strong>EE4</strong></div>
          </div>
          <div class="status-row">
            <div class="status-category">A un emploi</div>
            <div class="status-value" style="background-color: #E6F0F9; border-left: 4px solid #457B9D;">0%</div>
            <div class="status-value" style="background-color: #E6F0F9; border-left: 4px solid #457B9D;">75%</div>
            <div class="status-value" style="background-color: #E6F0F9; border-left: 4px solid #457B9D;">70%</div>
            <div class="status-value" style="background-color: #E6F0F9; border-left: 4px solid #457B9D;">73%</div>
          </div>
          <div class="status-row">
            <div class="status-category">Recherche</div>
            <div class="status-value" style="background-color: #FAF2E6; border-left: 4px solid #D69B5A;">44%</div>
            <div class="status-value" style="background-color: #FAF2E6; border-left: 4px solid #D69B5A;">14%</div>
            <div class="status-value" style="background-color: #FAF2E6; border-left: 4px solid #D69B5A;">9%</div>
            <div class="status-value" style="background-color: #FAF2E6; border-left: 4px solid #D69B5A;">3%</div>
          </div>
          <div class="status-row">
            <div class="status-category">Poursuit des études</div>
            <div class="status-value" style="background-color: #E6F7F4; border-left: 4px solid #2A9D8F;">56%</div>
            <div class="status-value" style="background-color: #E6F7F4; border-left: 4px solid #2A9D8F;">3%</div>
            <div class="status-value" style="background-color: #E6F7F4; border-left: 4px solid #2A9D8F;">4%</div>
            <div class="status-value" style="background-color: #E6F7F4; border-left: 4px solid #2A9D8F;">3%</div>
          </div>
          <div class="status-row">
            <div class="status-category">Inactif</div>
            <div class="status-value" style="background-color: #F9E9EC; border-left: 4px solid #A77A82;">0%</div>
            <div class="status-value" style="background-color: #F9E9EC; border-left: 4px solid #A77A82;">4%</div>
            <div class="status-value" style="background-color: #F9E9EC; border-left: 4px solid #A77A82;">2%</div>
            <div class="status-value" style="background-color: #F9E9EC; border-left: 4px solid #A77A82;">2%</div>
          </div>
          <div class="status-row">
            <div class="status-category">Non répondant</div>
            <div class="status-value" style="background-color: #e9e9f9; border-left: 4px solid #7d7aa7;">0%</div>
            <div class="status-value" style="background-color: #e9e9f9; border-left: 4px solid #7d7aa7;">4%</div>
            <div class="status-value" style="background-color: #e9e9f9; border-left: 4px solid #7d7aa7;">15%</div>
            <div class="status-value" style="background-color: #e9e9f9; border-left: 4px solid #7d7aa7;">19%</div>
          </div>
        </div>

        <button style="margin-top: 60px;" class="analysis-toggle" onclick="toggleAnalysis('chart2-analysis')">Afficher/Masquer l’analyse</button>
        <div id="chart2-analysis" class="analysis-content" style=" margin-top: 20px; font-size: 15px; line-height: 1.6; color: #333;">
        <!-- <div style="padding-top: 30px; margin-top: 20px; font-size: 15px; line-height: 1.6; color: #333;"> -->
          <h4 style="color: #15616D; margin: 30px 0 10px;">🔍 Analyse</h4>
          <ul style="padding-left: 20px;">
            <li><strong>Insertion rapide dans l’emploi :</strong> Dès l’ES2, la majorité des répondants sont en emploi (105 à l’ES2, stable à 95 pour les ES3 et ES4).</li>
            <li><strong>Diminution forte de la recherche d’emploi :</strong> De 140 à l’ES1 à seulement 4 à l’ES4.</li>
            <li><strong>Très faible poursuite d’études :</strong> Entre 4 et 5 étudiants poursuivent leurs études à chaque enquête.</li>
            <li><strong>Inactivité marginale :</strong> Cas d’inactivité rares, maximum 5 à l’ES2.</li>
            <li><strong>Bonne stabilité des réponses :</strong> Légère hausse des non-réponses mais données globalement fiables pour l’analyse.</li>
          </ul>

          <h4 style="color: #15616D; margin: 20px 0 10px;">🛠️ Recommandations</h4>
          <ol style="padding-left: 20px;">
            <li><strong>Mettre en avant les bons taux d’emploi :</strong> Utiliser des formules comme “Plus de 90 % des répondants en emploi”.</li>
            <li><strong>Montrer clairement l’évolution :</strong> Visualiser la baisse du nombre de chercheurs d’emploi et la stabilité des emplois entre ES2 et ES4.</li>
            <li><strong>Tableaux de bord segmentés :</strong> Ajouter des filtres par profil démographique ou académique pour une analyse fine.</li>
            <li><strong>Accompagner les derniers chercheurs :</strong> Développer des services ciblés pour les rares encore en recherche à l’ES4.</li>
            <li><strong>Réduire les non-réponses :</strong> Renforcer les relances pour limiter les absences de réponse dans les prochaines vagues.</li>
          </ol>
        </div>
      </div>


      <div class="chart-box">
        <h3>Situation Professionnelle à 6 mois après la certification</h3><br>
        <div id="pieChartStatut" class="chart-container" style="height: 300px;"></div>
        <div class="manual-legend2">
          <!-- <div class="legend-item">
            <span class="legend-color" style="background-color: #A77A82;"></span>
            <span class="legend-label">Oui</span>
          </div> -->
          <div class="legend-item2">
            <span class="legend-color2" style="background-color: #67b7dc;"></span>
            <span class="legend-label2">A un emploi <span style="color: #67b7dc; font-size: 16px"><strong>33%</strong></span></span>
          </div>
          <div class="legend-item2">
            <span class="legend-color2" style="background-color: #6794dc;"></span>
            <span class="legend-label2">Recherche <span style="color: #6794dc; font-size: 16px"><strong>6%</strong></span></span>
          </div>
          <div class="legend-item2">
            <span class="legend-color2" style="background-color: #6771dc;"></span>
            <span class="legend-label2">Poursuit des études <span style="color: #6771dc; font-size: 16px"><strong>57%</strong></span></span>
          </div>
          <div class="legend-item2">
            <span class="legend-color2" style="background-color: #8067dc;"></span>
            <span class="legend-label2">Inactif <span style="color: #8067dc; font-size: 16px"><strong>2%</strong></span></span>
          </div>
          <div class="legend-item2">
            <span class="legend-color2" style="background-color: #a367dc;"></span>
            <span class="legend-label2">Non répondant <span style="color: #a367dc; font-size: 16px"><strong>2%</strong></span></span>
          </div>
        </div>
        <!-- <div id="pieChartGenderLegend" style="margin-top: 10px;"></div> -->
      </div>
    </div>

    <div class="grid4" style="margin-bottom: 20px;">

      <div class="chart-box">
        <h3>Évolution du statut professionnel de l’étudiant</h3>
        <!-- <div class="manual-legend">
          <div class="legend-item">
            <span class="legend-color" style="background-color: #2A9D8F;"></span>
            <span class="legend-label">Ayant un poste de Manager</span>
          </div>
        </div> -->
        <div id="chartdivSankee"></div>

        <!-- <button class="analysis-toggle" onclick="toggleAnalysis('chart4-analysis')">Afficher/Masquer l’analyse</button>
        <div id="chart4-analysis" class="analysis-content" style="margin-top: 20px; font-size: 15px; line-height: 1.6; color: #333;">
          <h4 style="color: #15616D; margin: 30px 0 10px;">🔍 Analyse</h4>
          <ul style="padding-left: 20px;">
            <li><strong>Nombre croissant de managers :</strong> de 20 à 30 entre EE2 et EE4.</li>
            <li><strong>Progression constante :</strong> environ +5 à chaque vague.</li>
            <li><strong>Encore une minorité :</strong> seulement 25 % environ sont managers à EE4.</li>
            <li><strong>Mobilité ascendante :</strong> le programme semble favoriser l’évolution de carrière.</li>
          </ul>

          <h4 style="color: #15616D; margin: 20px 0 10px;">🛠️ Recommandations</h4>
          <ol style="padding-left: 20px;">
            <li><strong>Partager des parcours inspirants :</strong> anciens élèves devenus managers.</li>
            <li><strong>Mettre en avant la progression :</strong> sous forme graphique ou comparative.</li>
            <li><strong>Offrir un accompagnement au leadership :</strong> coaching, mentorat ou formations.</li>
            <li><strong>Utiliser dans la communication :</strong> pour démontrer l’impact long terme du diplôme.</li>
          </ol>
        </div> -->

      </div>
    </div>

    <div class="grid">
      <div class="chart-box">
        <h3>Type de contrat</h3>
        <div id="chart3" class="chart-container"></div>
        <button class="analysis-toggle" onclick="toggleAnalysis('chart3-analysis')">Afficher/Masquer l’analyse</button>
        <div id="chart3-analysis" class="analysis-content" style="margin-top: 20px; font-size: 15px; line-height: 1.6; color: #333;">
          <h4 style="color: #15616D; margin: 30px 0 10px;">🔍 Analyse</h4>
          <ul style="padding-left: 20px;">
            <li><strong>CDI largement dominant :</strong> Plus de 60 diplômés par vague sont en contrat stable.</li>
            <li><strong>CDD et intérim peu présents :</strong> Ce qui montre une insertion rapide et sécurisée.</li>
            <li><strong>L’auto-entrepreneuriat reste solide :</strong> Environ 15 répondants en EE2–EE3.</li>
            <li><strong>Carrières variées :</strong> Fonctionnaire, gérant, indépendant — diversité des choix.</li>
          </ul>

          <h4 style="color: #15616D; margin: 20px 0 10px;">🛠️ Recommandations</h4>
          <ol style="padding-left: 20px;">
            <li><strong>Mettre en avant les CDI :</strong> Témoignages d’alumni, données chiffrées.</li>
            <li><strong>Accompagner les entrepreneurs :</strong> Coaching, incubateurs, mise en réseau.</li>
            <li><strong>Étudier la baisse de l’intérim :</strong> Pour mieux comprendre la tendance.</li>
            <li><strong>Segmenter les services :</strong> Salariés vs indépendants = besoins différents.</li>
          </ol>
        </div>

      </div>



      <div class="chart-box">
        <h3>Top 8 fonctions</h3>
        <div id="chart5" class="chart-container"></div>
        <button class="analysis-toggle" onclick="toggleAnalysis('chart5-analysis')">Afficher/Masquer l’analyse</button>
        <div id="chart5-analysis" class="analysis-content" style="margin-top: 20px; font-size: 15px; line-height: 1.6; color: #333;">
          <h4 style="color: #15616D; margin: 30px 0 10px;">🔍 Analyse</h4>
          <ul style="padding-left: 20px;">
            <li><strong>Les fonctions commerciales dominent :</strong> Conseiller commercial, Commercial, Responsable des ventes sont les plus fréquentes.</li>
            <li><strong>Les postes marketing sont rares :</strong> Très peu de “Responsable marketing”, “Chef de produit”, etc.</li>
            <li><strong>La catégorie “Autre” est surutilisée :</strong> 48 réponses en EE2 et EE4 la rendent difficile à exploiter.</li>
            <li><strong>Peu de changements dans le temps :</strong> La structure des rôles reste stable entre EE2 et EE4.</li>
          </ul>

          <h4 style="color: #15616D; margin: 20px 0 10px;">🛠️ Recommandations</h4>
          <ol style="padding-left: 20px;">
            <li><strong>Réviser les intitulés de poste :</strong> Inclure les rôles fréquents classés dans “Autre”.</li>
            <li><strong>Mettre en avant les rôles clés :</strong> Aide à l’orientation des futurs diplômés.</li>
            <li><strong>Analyser les rôles “Autre” :</strong> Ajouter un champ libre pour recueillir ces intitulés.</li>
            <li><strong>Adapter les services carrière :</strong> Se concentrer sur les postes réellement occupés par les alumni.</li>
          </ol>
        </div>

      </div>



    </div>

    <img style="padding-top: 50px;" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iNzVweCIgaGVpZ2h0PSIyMXB4IiB2aWV3Qm94PSIwIDAgNzUgMjEiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDUyLjQgKDY3Mzc4KSAtIGh0dHA6Ly93d3cuYm9oZW1pYW5jb2RpbmcuY29tL3NrZXRjaCAtLT4KICAgIDx0aXRsZT5sb2dvPC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGcgaWQ9IjAzIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPgogICAgICAgIDxnIGlkPSIwMSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTE4My4wMDAwMDAsIC0xNC4wMDAwMDApIiBzdHJva2Utd2lkdGg9IjIiPgogICAgICAgICAgICA8ZyBpZD0iSGVhZGVyIj4KICAgICAgICAgICAgICAgIDxnIGlkPSJsb2dvIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxODQuMDAwMDAwLCAxNS4wMDAwMDApIj4KICAgICAgICAgICAgICAgICAgICA8ZyBpZD0iYW1Mb2dvIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTcxLjYyMjY0MTUsMTkgTDQ1Ljk0MDI0NDIsMTkgQzMyLjQ1NDk5NDksMTguOTYzOTAxIDM0LjY0NDc5ODQsMCAyNC4wODEyNDQ1LDAgQzEzLjUxNzY5MDcsMCAxNS43MDc4MjQ4LDE4Ljk2MzkwMSAyLjM1Nzk5NDA5LDE5IEwtOC41NjU5MDI3NWUtMTQsMTkiIGlkPSJTdHJva2UtMSIgc3Ryb2tlPSIjNUVCMEZDIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0wLDE5IEwyMS43NDQ2ODA5LDE5IEMyNS40MTcyNjIzLDE4Ljk3OTYzODggMjguMjk0ODI5MiwxOC4wNzI3NDI0IDMwLjkwMjA5MTgsMTQuOTM4NDI0NSBDMzIuMzk2MzEwOCwxMy4xNDIyMDE2IDMzLjcxMzkxMzEsMTEuMTYyMzk5IDM0Ljc2MzkwMDgsOS4wMTc0MDc2NyBDMzUuNjAzMDU0MSw3LjMwMjk1ODExIDM2LjA3MDc0NDcsNS4zMTU0MzggMzcuMTc1NTcwMiwzLjc2ODQ3NjEgQzM4LjAzNDQ0NzIsMi41NjU4NDkwOSAzOS45OTg0NDg2LDIuMzMwMDUyNzUgNDEuMDM0MDkxOCwzLjM3NzUwNzM4IEM0Mi43MjA0NjczLDUuMDgzNDE4MzUgNDMuMzMyOTQ3NywxMS4wODUyMjMzIDQ2LjA1MjcyNSwxMS4yNzk4MDQ2IEM0OC42MzQyODcxLDExLjQ2NDY5NzggNDkuMzg4NDE5NSw1LjUyMDY5MjQ4IDUwLjg5MTMwNDksMy43NzcxNzg4OCBDNTMuNjA2MTUxMywwLjYyODkwMzY4MiA1Ni4xMDY4NzYyLDQuMTI0MTQxMDUgNTcuMjAwMzQ1Niw2Ljg5MDMxNDUyIEM1OS42MTQxMDY5LDEyLjk5NjM4ODggNjMuODYwMjI5LDE4Ljk5OTgzNTggNzAuNjcwMjEyOCwxOC45OTk4MzU4IEw3MywxOC45OTk4MzY2IiBpZD0iUGFnZS0xIiBzdHJva2U9IiNGRkZGRkYiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTIzLjQxNTA5NDMsMCBDMTMuMTY0NDMzNCwwIDE1LjI4OTU1MDksMTkuMDYxMzgxOSAyLjI2MzI1NTMxLDE4Ljk5OTg1MTQgTDEuMjQzNDQ5NzllLTEzLDE4Ljk5OTg1MTQiIGlkPSJTdHJva2UtMyIgc3Ryb2tlPSIjNUVCMEZDIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPC9nPgogICAgICAgICAgICAgICAgPC9nPgogICAgICAgICAgICA8L2c+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4=" alt="Nextera Logo">
  </main>

  <!-- Charts Initialization Scripts -->
  <script>
am5.ready(function() {
  // Chart 1: Stacked Column Chart (unchanged)
  // Chart 1: Stacked Column Chart
  var root = am5.Root.new("chart1");
  root._logo.dispose();
  root.setThemes([am5themes_Animated.new(root)]);

  var chart = root.container.children.push(
    am5xy.XYChart.new(root, {
      panX: false,
      panY: false,
      wheelX: "none",
      wheelY: "none",
      layout: root.verticalLayout,
      paddingBottom: 50,
      paddingTop: 60, // Increased to accommodate the legend at the top
      paddingLeft: 15,
      paddingRight: 15
    })
  );

  var data = [
    { stage: "EE1", Sent: 318, Opened: 318, Started: 318, Completed: 318 },
    { stage: "EE2", Sent: 140, Opened: 134, Started: 134, Completed: 133 },
    { stage: "EE3", Sent: 136, Opened: 117, Started: 117, Completed: 115 },
    { stage: "EE4", Sent: 131, Opened: 108, Started: 108, Completed: 104 }
  ];

  // Create the legend and add it first (so it appears at the top)
  var legend = chart.children.push(
    am5.Legend.new(root, {
      centerX: am5.percent(50), // Center horizontally
      x: am5.percent(50),
      centerY: am5.percent(0), // Align to the top
      y: am5.percent(0),
      layout: am5.GridLayout.new(root, {
        maxColumns: 3, // Display items horizontally (3 columns)
        fixedWidthGrid: false
      }),
      paddingTop: 10,
      paddingBottom: 20
    })
  );

  legend.labels.template.setAll({
    fontSize: 16,
    fill: am5.color("#666666"),
    fontFamily: "Segoe UI"
  });

  legend.markers.template.setAll({
    width: 12,
    height: 12
  });

  var xRenderer = am5xy.AxisRendererX.new(root, {
    minGridDistance: 80,
    cellStartLocation: 0.2,
    cellEndLocation: 0.8,
    strokeOpacity: 0
  });

  xRenderer.labels.template.setAll({
    fontSize: 14,
    fill: am5.color("#666666"),
    fontFamily: "Segoe UI"
  });

  xRenderer.grid.template.set("visible", false);

  var xAxis = chart.xAxes.push(
    am5xy.CategoryAxis.new(root, {
      categoryField: "stage",
      renderer: xRenderer,
      tooltip: am5.Tooltip.new(root, {})
    })
  );
  xAxis.data.setAll(data);

  var yRenderer = am5xy.AxisRendererY.new(root, {
    strokeOpacity: 0
  });

  yRenderer.labels.template.setAll({
    fontSize: 14,
    fill: am5.color("#666666"),
    fontFamily: "Segoe UI"
  });

  yRenderer.grid.template.setAll({
    strokeOpacity: 0.1,
    stroke: am5.color("#A0A0A0")
  });

  var yAxis = chart.yAxes.push(
    am5xy.ValueAxis.new(root, {
      renderer: yRenderer,
      min: 0,
      max: 900
    })
  );

  function createSeries(name, field, color) {
    // Calculate totals for each stage
    let totals = {};
    data.forEach(item => {
      totals[item.stage] = (totals[item.stage] || 0) + item[field];
    });

    var series = chart.series.push(
      am5xy.ColumnSeries.new(root, {
        name: name,
        xAxis: xAxis,
        yAxis: yAxis,
        valueYField: field,
        categoryXField: "stage",
        clustered: true
      })
    );

    series.columns.template.setAll({
      width: am5.percent(85),
      fill: am5.color(color),
      stroke: am5.color(color),
      cornerRadiusTL: 3,
      cornerRadiusTR: 3
    });

    // Preprocess data to calculate accurate 100% percentages
    data.forEach(row => {
      let total = 318;

      if (row.stage === 'EE2') {
        total = 140;
      } else if (row.stage === 'EE3') {
        total = 136;
      } else if (row.stage === 'EE4') {
        total = 131;
      }

      const rawPercents = {
        Sent: total ? (row.Sent / total) * 100 : 0,
        Opened: total ? (row.Opened / total) * 100 : 0,
        Started: total ? (row.Started / total) * 100 : 0,
        Completed: total ? (row.Completed / total) * 100 : 0,
      };

      // Round down all values
      let rounded = {
        Sent: Math.floor(rawPercents.Sent),
        Opened: Math.floor(rawPercents.Opened),
        Started: Math.floor(rawPercents.Started),
        Completed: Math.floor(rawPercents.Completed)
      };

      let sum = rounded.Sent + rounded.Opened + rounded.Started + rounded.Completed;

      // Distribute remaining percentage to highest remainder
      let remainders = [
        { key: "Sent", value: rawPercents.Sent - rounded.Sent },
        { key: "Opened", value: rawPercents.Opened - rounded.Opened },
        { key: "Started", value: rawPercents.Started - rounded.Started },
        { key: "Completed", value: rawPercents.Completed - rounded.Completed }
      ];

      remainders.sort((a, b) => b.value - a.value); // Sort by biggest remainder

      let i = 0;
      while (sum < 100 && i < remainders.length) {
        rounded[remainders[i].key]++;
        sum++;
        i++;
      }

      // Attach to row
      row.SentPercent = rounded.Sent;
      row.OpenedPercent = rounded.Opened;
      row.StartedPercent = rounded.Started;
      row.CompletedPercent = rounded.Completed;
    });

    // Set dynamic tooltip with percentage
    series.columns.template.adapters.add("tooltipText", function(text, target) {
      const dataItem = target.dataItem.dataContext;
      let percentField = field + "Percent"; // e.g., "OpenedPercent"
      return `${name}: ${dataItem[field]} (${dataItem[percentField]}%)`;
    });

    series.columns.template.set("tooltip", am5.Tooltip.new(root, {
      pointerOrientation: "vertical",
      getFillFromSprite: true,
      getStrokeFromSprite: true,
      autoTextColor: true,
      paddingTop: 6,
      paddingBottom: 6,
      paddingLeft: 10,
      paddingRight: 10
    }));

    series.columns.template.states.create("hover", {
      fillOpacity: 0.8
    });

    // Conditionally add label bullet (skip for "Started" series)
    if (field !== "Opened") {
      series.bullets.push(function () {
        return am5.Bullet.new(root, {
          locationY: 1,
          sprite: am5.Label.new(root, {
            text: `{${field}Percent}%`, // e.g., "383 | 100%"
            centerY: am5.percent(0),
            centerX: am5.percent(50),
            dy: -30,
            populateText: true,
            fontSize: 13,
            fontWeight: "500",
            fill: am5.color("#333")
          })
        });
      });
    }

    series.data.setAll(data);
    series.appear();

    legend.data.push(series);
    return series;
  }

  createSeries("Envoyées", "Sent", "#8FD2D2");
  createSeries("Ouvertes", "Opened", "#4A90E2");
  // createSeries("Ouverture de l'enquête", "Started", "#4A90E2");
  createSeries("Complétées", "Completed", "#0E3F2D");

  chart.appear(1000, 100);


  // Chart 2: Donut/Ring Chart for Statut professionnel (with createSeries function)
  // Chart 2: Statut professionnel (4 Donut Charts EE1–EE4)
  // const chart2Data = {
  //   EE1: [
  //     { category: "Aucune activité", value: 0, index: 4 },
  //     { category: "Recherche un emploi", value: 0, index: 3 },
  //     { category: "Poursuit des études", value: 0, index: 2 },
  //     { category: "A un emploi", value: 0, index: 1 },
  //   ],
  //   EE2: [
  //     { category: "Aucune activité", value: 5, index: 4 },
  //     { category: "Recherche un emploi", value: 20, index: 3 },
  //     { category: "Poursuit des études", value: 4, index: 2 },
  //     { category: "A un emploi", value: 105, index: 1 },
  //   ],
  //   EE3: [
  //     { category: "Aucune activité", value: 3, index: 4 },
  //     { category: "Recherche un emploi", value: 12, index: 3 },
  //     { category: "Poursuit des études", value: 5, index: 2 },
  //     { category: "A un emploi", value: 95, index: 1 },
  //   ],
  //   EE4: [
  //     { category: "Aucune activité", value: 3, index: 4 },
  //     { category: "Recherche un emploi", value: 4, index: 3 },
  //     { category: "Poursuit des études", value: 4, index: 2 },
  //     { category: "A un emploi", value: 95, index: 1 },
  //   ]
  // };

  // // Colors by category (consistent across all ES charts)
  // const statusColors = {
  //   "A un emploi": am5.color("#457B9D"),       // Muted blue (from CDD)
  //   "Recherche un emploi": am5.color("#D69B5A"),     // Muted sandy yellow (from Fonctionnaire)
  //   "Poursuit des études": am5.color("#2A9D8F"), // Teal-green (from Auto-Entrepreneur)
  //   "Aucune activité": am5.color("#A77A82")       // Softer rose taupe (from Mandataire Social)
  // };

  // // Create chart for each ES
  // function createDonutChartES(containerId, esLabel, data) {
  //   const root = am5.Root.new(containerId);
  //   root.setThemes([am5themes_Animated.new(root)]);

  //   const chart = root.container.children.push(
  //     am5percent.PieChart.new(root, {
  //       layout: root.verticalLayout,
  //       innerRadius: am5.percent(50),
  //       // outerWidth: am5.percent(50),
  //       paddingTop: 10,
  //     })
  //   );

  //   // Add label in the center
  //   chart.seriesContainer.children.push(
  //     am5.Label.new(root, {
  //       text: esLabel,
  //       fontSize: 18,
  //       fontWeight: "600",
  //       centerX: am5.percent(50),
  //       centerY: am5.percent(50),
  //       fill: am5.color("#333")
  //     })
  //   );

  //   const series = chart.series.push(
  //     am5percent.PieSeries.new(root, {
  //       valueField: "value",
  //       categoryField: "category",
  //       alignLabels: false
  //     })
  //   );

  //   // Configure the labels
  //   series.labels.template.setAll({
  //     text: "{value} | {valuePercentTotal.formatNumber('#.0')}%", // Display value and percentage
  //     fontSize: 14,
  //     radius: 0,
  //     fontFamily: "Segoe UI, Tahoma, Geneva, Verdana, sans-serif",
  //     fontWeight: "500",
  //     centerX: am5.percent(50),
  //     centerY: am5.percent(50),
  //     fill: am5.color("#333") // Temporary default color
  //   });

  //   series.labels.template.adapters.add("radius", (radius, target) => {
  //     const index = target.dataItem.dataContext.index;
  //     return index === 3 && esLabel === 'EE4' ? 22 : radius; // inside → negative, outside → positive
  //   });

  //   series.ticks.template.set("visible", false);
  //   // series.ticks.template.setAll({
  //   //   visible: true,
  //   //   stroke: am5.color("#0E3F2D"),
  //   //   strokeWidth: 3
  //   // });

  //   series.slices.template.adapters.add("fill", (fill, target) => {
  //     const cat = target.dataItem.dataContext.category;
  //     return statusColors[cat] || am5.color("#ccc");
  //   });

  //   series.slices.template.setAll({
  //     tooltipText: "{category}: {value} ({valuePercentTotal.formatNumber('#.0')}%)", // Update tooltip to include percentage
  //     stroke: am5.color("#fff"),
  //     strokeWidth: 1.5,
  //     cornerRadius: 6
  //   });

  //   // Set the data for the series
  //   series.data.setAll(data);

  //   // Update the label colors to match the slices
  //   series.labels.each((label) => {
  //     const dataItem = label.dataItem;
  //     if (dataItem) {
  //       const category = dataItem.get("category");
  //       const color = statusColors[category] || am5.color("#ccc");
  //       label.set("fill", color);
  //     }
  //   });
  // }

  // // Create all 4 charts
  // createDonutChartES("chart2-es1", "EE1", chart2Data.EE1);
  // createDonutChartES("chart2-es2", "EE2", chart2Data.EE2);
  // createDonutChartES("chart2-es3", "EE3", chart2Data.EE3);
  // createDonutChartES("chart2-es4", "EE4", chart2Data.EE4);


  // Chart 3: Type de Contrat (Horizontal Grouped Bar Chart)

  var root3 = am5.Root.new("chart3");
  root3._logo.dispose();
  root3.setThemes([am5themes_Animated.new(root3)]);

  var chart3 = root3.container.children.push(am5xy.XYChart.new(root3, {
    layout: root3.verticalLayout,
    paddingTop: 20,
    paddingBottom: 50,
    panX: true,
    panY: true,
    wheelX: "panX",
    wheelY: "zoomY",
    pinchZoomX: true
  }));

  // Define custom color set
  chart3.get("colors").set("colors", [
    am5.color("#BCDCDC"), // EE1
    am5.color("#68B3B3"), // EE2
    am5.color("#2A8A8A"), // EE3
    am5.color("#0E4B4B")  // EE4
  ]);

  chart3.set("scrollbarY", am5.Scrollbar.new(root3, {
    orientation: "vertical",
  }));

  // Combined dataset across EE1–EE4
  let datasets3Combined = [
    { type: "CDI", EE1: 0, EE2: 63, EE3: 58, EE4: 64 },
    { type: "CDD", EE1: 0, EE2: 9, EE3: 11, EE4: 9 },
    { type: "Intérim", EE1: 0, EE2: 7, EE3: 3, EE4: 0 },
    { type: "Fonctionnaire", EE1: 0, EE2: 1, EE3: 1, EE4: 1 },
    { type: "Contractuel", EE1: 0, EE2: 3, EE3: 1, EE4: 1 },
    { type: "Auto-Entrepreneur", EE1: 0, EE2: 15, EE3: 15, EE4: 10 },
    { type: "Gérant", EE1: 0, EE2: 3, EE3: 5, EE4: 4 },
    { type: "Indépendant", EE1: 0, EE2: 2, EE3: 1, EE4: 3 },
    { type: "Mandataire Social", EE1: 0, EE2: 0, EE3: 0, EE4: 0 },
    { type: "Autre", EE1: 0, EE2: 2, EE3: 0, EE4: 1 }
  ];

  // Filter out "Autre" category
  // datasets3Combined = datasets3Combined.filter(item => item.type !== "Autre"); // Exclude "Other" category
  
  const top8Chart3 = datasets3Combined
    .sort((a, b) => (b.EE1 + b.EE2 + b.EE3 + b.EE4) - (a.EE1 + a.EE2 + a.EE3 + a.EE4))
    .slice(0, 8);

  const categoryBaseColors = {
    "CDI": "#1D3557",
    "CDD": "#457B9D",
    "Intérim": "#A8DADC",
    "Fonctionnaire": "#F4A261",
    "Contractuel": "#E76F51",
    "Auto-Entrepreneur": "#2A9D8F",
    "Gérant": "#264653",
    "Indépendant": "#6D597A",
    "Mandataire Social": "#B5838D",
    "Autre": "#ADB5BD"
  };

  function shadeColor(color, percent) {
    // Lighten or darken by percent (-20 is darker, +20 is lighter)
    let f = parseInt(color.slice(1), 16),
        t = percent < 0 ? 0 : 255,
        p = Math.abs(percent) / 100,
        R = f >> 16,
        G = f >> 8 & 0x00FF,
        B = f & 0x0000FF;
    return "#" + (
      0x1000000 +
      (Math.round((t - R) * p) + R) * 0x10000 +
      (Math.round((t - G) * p) + G) * 0x100 +
      (Math.round((t - B) * p) + B)
    ).toString(16).slice(1);
  }

  // Create Y Axis (Categories)
  var yAxis3 = chart3.yAxes.push(
    am5xy.CategoryAxis.new(root3, {
      categoryField: "type",
      renderer: am5xy.AxisRendererY.new(root3, {
        minGridDistance: 40, // ⬅️ Increase this for more space
        inversed: true,
        cellStartLocation: 0.05,
        cellEndLocation: 0.95
      })
    })
  );
  yAxis3.data.setAll(top8Chart3);

  // yAxis3.get("renderer").labels.template.setAll({
  //   oversizedBehavior: "wrap",         // or "truncate"
  //   maxWidth: 120,                      // ⬅️ Give space to long labels
  //   fontSize: 14,
  //   fontWeight: "500",
  //   fill: am5.color("#333")
  // });

  // Create X Axis (Values)
  var xAxis3 = chart3.xAxes.push(
    am5xy.ValueAxis.new(root3, {
      min: 0,
      renderer: am5xy.AxisRendererX.new(root3, {})
    })
  );

  // Function to create a series
  function makeSeries(name, field) {
    let esIndex = { "EE1": 50, "EE2": 20, "EE3": -20, "EE4": -50 }[name]; // Lighter to darker

    let series = chart3.series.push(
      am5xy.ColumnSeries.new(root3, {
        name,
        xAxis: xAxis3,
        yAxis: yAxis3,
        valueXField: field,
        categoryYField: "type",
        clustered: true
      })
    );

    series.columns.template.setAll({
      tooltipText: `${name} - {categoryY}: {valueX}`,
      height: am5.percent(90),
      width: am5.percent(55),
      strokeOpacity: 0
    });

    // Dynamically assign color Basé sur category and series
    series.columns.template.adapters.add("fill", function(fill, target) {
      let category = target.dataItem.dataContext.type;
      let base = categoryBaseColors[category] || "#999";
      return am5.color(shadeColor(base, esIndex));
    });

    series.columns.template.adapters.add("stroke", (stroke, target) => {
      let category = target.dataItem.dataContext.type;
      let base = categoryBaseColors[category] || "#999";
      return am5.color(shadeColor(base, esIndex));
    });

    const esLabelColors = {
      EE1: "#6D597A",
      EE2: "#2A9D8F",
      EE3: "#F4A261",
      EE4: "#E76F51"
    };

    // Label bullets (unchanged)
    series.bullets.push(function () {
      let label = am5.Label.new(root3, {
        fontSize: 12,
        fontFamily: "Segoe UI, Tahoma, Geneva, Verdana, sans-serif",// match your header
        fontWeight: "500",
        centerY: am5.percent(50),
        centerX: am5.percent(0),
        dx: 1 // space between end of bar and label
      });

      // Set label text
      label.adapters.add("text", function (text, target) {
        let value = target.dataItem.get("valueX");
        let esLabel = target.dataItem.component.get("name");  // ← gets "EE1", etc.
        return `${value}`;
      });

      // Match text color to the fill color of its parent column
      label.adapters.add("fill", function (fill, target) {
        let category = target.dataItem.dataContext.type;         // e.g., "CDI"
        let base = categoryBaseColors[category] || "#999";
        return am5.color(shadeColor(base, esIndex));             // same function as bar
      });

      return am5.Bullet.new(root3, {
        locationX: 1,
        sprite: label
      });
    });


    series.data.setAll(top8Chart3);

    series.events.once("datavalidated", function () {
      am5.array.each(series.dataItems, function(dataItem) {
        if (dataItem.get("valueX") === 0) {
          dataItem.set("valueXWorking", 0.5);
        }
      });
    });
  }

  // Create grouped bars for EE1–EE4
  makeSeries("EE1", "EE1");
  makeSeries("EE2", "EE2");
  makeSeries("EE3", "EE3");
  makeSeries("EE4", "EE4");
  // makeSeries("EE1", "EE1", "#BCDCDC");
  // makeSeries("EE2", "EE2", "#68B3B3");
  // makeSeries("EE3", "EE3", "#2A8A8A");
  // makeSeries("EE4", "EE4", "#0E4B4B");


  // Chart 4: Niveau managérial (Line Chart)
  const chart4DataLine = [
    { es: "EE1", Oui: 0,  },
    { es: "EE2", Oui: 20, },
    { es: "EE3", Oui: 25, },
    { es: "EE4", Oui: 30, }
  ];

  function createLineChartManager(containerId, data) {
    const root = am5.Root.new(containerId);
    root._logo.dispose();

    root.setThemes([am5themes_Animated.new(root)]);

    const chart = root.container.children.push(
      am5xy.XYChart.new(root, {
        panX: false,
        panY: false,
        wheelX: "none",
        wheelY: "none",
        layout: root.verticalLayout
      })
    );

    // X Axis (Categories: EE1, EE2...)
    const xAxis = chart.xAxes.push(
      am5xy.CategoryAxis.new(root, {
        categoryField: "es",
        renderer: am5xy.AxisRendererX.new(root, { minGridDistance: 30 }),
        tooltip: am5.Tooltip.new(root, {})
      })
    );
    xAxis.data.setAll(data);

    // Y Axis (Values)
    const yAxis = chart.yAxes.push(
      am5xy.ValueAxis.new(root, {
        renderer: am5xy.AxisRendererY.new(root, {})
      })
    );

    // Line series function
    function createSeries(field, name, color) {
      const series = chart.series.push(
        am5xy.LineSeries.new(root, {
          name: name,
          xAxis: xAxis,
          yAxis: yAxis,
          valueYField: field,
          categoryXField: "es",
          stroke: color,
          fill: color,
          tooltip: am5.Tooltip.new(root, {
            labelText: `Ayant un poste de Manager: {valueY}`
          })
        })
      );

      series.strokes.template.setAll({
        strokeWidth: 3
      });

      series.bullets.push(() =>
        am5.Bullet.new(root, {
          sprite: am5.Circle.new(root, {
            radius: 5,
            fill: color,
            stroke: am5.color(0xffffff),
            strokeWidth: 2
          })
        })
      );

      series.data.setAll(data);
    }

    // Add "Oui" and "Non" series
    createSeries("Oui", "Oui", am5.color("#2A9D8F"));
    // createSeries("Non", "Non", am5.color("#A77A82"));

    chart.set("cursor", am5xy.XYCursor.new(root, {
      behavior: "none",
      xAxis: xAxis,
      yAxis: yAxis
    }));

    chart.appear(1000, 100);
  }

  // Render the chart
  createLineChartManager("chart4", chart4DataLine);


  // Chart 5: Top 8 fonctions with tabs and dynamic update
  // Chart 5: Top 8 fonctions (Grouped Horizontal Bar Chart)

  var root5 = am5.Root.new("chart5");
  root5._logo.dispose();
  root5.setThemes([am5themes_Animated.new(root5)]);

  var chart5 = root5.container.children.push(am5xy.XYChart.new(root5, {
    layout: root5.verticalLayout,
    paddingTop: 20,
    paddingBottom: 50,
    panX: true,
    panY: true,
    wheelX: "panX",
    wheelY: "zoomY",
    pinchZoomX: true
  }));

  chart5.set("scrollbarY", am5.Scrollbar.new(root5, {
    orientation: "vertical"
  }));

  // Your original data
  const datasets5 = {
    EE1: [
      { category: "Représentant commercial", value: 0 },
      { category: "Chargé(e) de communication", value: 0 },
      { category: "Chargé(e) d'études marketing", value: 0 },
      { category: "Responsable de marché", value: 0 },
      { category: "Responsable marketing", value: 0 },
      { category: "Responsable de marque", value: 0 },
      { category: "Chef de produit", value: 0 },
      { category: "Chef de projet marketing", value: 0 },
      { category: "Responsable de secteur", value: 0 },
      { category: "Commercial", value: 0 },
      { category: "Conseiller commercial", value: 0 },
      { category: "Responsable des ventes", value: 0 },
      { category: "Directeur commercial", value: 0 },
      { category: "Responsable performance marketing et ventes", value: 0 },
      { category: "Responsable de département/univers", value: 0 },
      { category: "Responsable des études marketing", value: 0 },
      { category: "Autre", value: 0 }
    ],
    EE2: [
      { category: "Représentant commercial", value: 3 },
      { category: "Chargé(e) de communication", value: 1 },
      { category: "Chargé(e) d'études marketing", value: 0 },
      { category: "Responsable de marché", value: 0 },
      { category: "Responsable marketing", value: 0 },
      { category: "Responsable de marque", value: 0 },
      { category: "Chef de produit", value: 0 },
      { category: "Chef de projet marketing", value: 0 },
      { category: "Responsable de secteur", value: 3 },
      { category: "Commercial", value: 19 },
      { category: "Conseiller commercial", value: 24 },
      { category: "Responsable des ventes", value: 4 },
      { category: "Directeur commercial", value: 1 },
      { category: "Responsable performance marketing et ventes", value: 0 },
      { category: "Responsable de département/univers", value: 1 },
      { category: "Responsable des études marketing", value: 1 },
      { category: "Autre", value: 48 }
    ],
    EE3: [
      { category: "Représentant commercial", value: 3 },
      { category: "Chargé(e) de communication", value: 0 },
      { category: "Chargé(e) d'études marketing", value: 0 },
      { category: "Responsable de marché", value: 0 },
      { category: "Responsable marketing", value: 0 },
      { category: "Responsable de marque", value: 0 },
      { category: "Chef de produit", value: 0 },
      { category: "Chef de projet marketing", value: 1 },
      { category: "Responsable de secteur", value: 2 },
      { category: "Commercial", value: 20 },
      { category: "Conseiller commercial", value: 21 },
      { category: "Responsable des ventes", value: 5 },
      { category: "Directeur commercial", value: 0 },
      { category: "Responsable performance marketing et ventes", value: 0 },
      { category: "Responsable de département/univers", value: 1 },
      { category: "Responsable des études marketing", value: 0 },
      { category: "Autre", value: 42 }
    ],
    EE4: [
      { category: "Représentant commercial", value: 4 },
      { category: "Chargé(e) de communication", value: 1 },
      { category: "Chargé(e) d'études marketing", value: 0 },
      { category: "Responsable de marché", value: 0 },
      { category: "Responsable marketing", value: 0 },
      { category: "Responsable de marque", value: 0 },
      { category: "Chef de produit", value: 0 },
      { category: "Chef de projet marketing", value: 0 },
      { category: "Responsable de secteur", value: 0 },
      { category: "Commercial", value: 14 },
      { category: "Conseiller commercial", value: 19 },
      { category: "Responsable des ventes", value: 5 },
      { category: "Directeur commercial", value: 1 },
      { category: "Responsable performance marketing et ventes", value: 0 },
      { category: "Responsable de département/univers", value: 1 },
      { category: "Responsable des études marketing", value: 0 },
      { category: "Autre", value: 48 }
    ]
  };

  // Step 1: Combine into grouped format
  function combineESData(datasets) {
    const combined = {};
    for (const es of ["EE1", "EE2", "EE3", "EE4"]) {
      datasets[es].forEach(item => {
        if (!combined[item.category]) {
          combined[item.category] = {
            category: item.category, EE1: 0, EE2: 0, EE3: 0, EE4: 0
          };
        }
        combined[item.category][es] = item.value;
      });
    }
    return Object.values(combined);
  }

  let dataset5Combined = combineESData(datasets5);
  const top8 = dataset5Combined
    .sort((a, b) => (b.EE1 + b.EE2 + b.EE3 + b.EE4) - (a.EE1 + a.EE2 + a.EE3 + a.EE4))
    .slice(0, 8);

  // yAxis5.data.setAll(top8);
  // series.data.setAll(top8); // for each series


  // Step 2: Set base color per category
  const jobBaseColors = {
    "Représentant commercial": "#1D3557",
    "Chargé(e) de communication": "#457B9D",
    "Chargé(e) d'études marketing": "#A8DADC",
    "Responsable de marché": "#F4A261",
    "Responsable marketing": "#E76F51",
    "Responsable de marque": "#2A9D8F",
    "Chef de produit": "#264653",
    "Chef de projet marketing": "#6D597A",
    "Responsable de secteur": "#B5838D",
    "Commercial": "#8ECAE6",
    "Conseiller commercial": "#219EBC",
    "Responsable des ventes": "#023047",
    "Directeur commercial": "#FFB703",
    "Responsable performance marketing et ventes": "#FB8500",
    "Responsable de département/univers": "#9B5DE5",
    "Responsable des études marketing": "#F15BB5",
    "Autre": "#ADB5BD"
  };

  // Shading utility (same as Chart 3)
  function shadeColor(color, percent) {
    let f = parseInt(color.slice(1), 16),
        t = percent < 0 ? 0 : 255,
        p = Math.abs(percent) / 100,
        R = f >> 16,
        G = f >> 8 & 0x00FF,
        B = f & 0x0000FF;
    return "#" + (
      0x1000000 +
      (Math.round((t - R) * p) + R) * 0x10000 +
      (Math.round((t - G) * p) + G) * 0x100 +
      (Math.round((t - B) * p) + B)
    ).toString(16).slice(1);
  }

  // Step 3: Create axes
  const yAxis5 = chart5.yAxes.push(
    am5xy.CategoryAxis.new(root5, {
      categoryField: "category",
      renderer: am5xy.AxisRendererY.new(root5, {
        minGridDistance: 40,
        inversed: true,
        cellStartLocation: 0.05,
        cellEndLocation: 0.95
      })
    })
  );
  yAxis5.data.setAll(top8);

  const xAxis5 = chart5.xAxes.push(
    am5xy.ValueAxis.new(root5, {
      min: 0,
      renderer: am5xy.AxisRendererX.new(root5, {})
    })
  );

  // Step 4: Create grouped series
  function makeSeries5(name, field) {
    const esShade = { EE1: 50, EE2: 20, EE3: -20, EE4: -50 }[name];

    const series = chart5.series.push(
      am5xy.ColumnSeries.new(root5, {
        name,
        xAxis: xAxis5,
        yAxis: yAxis5,
        valueXField: field,
        categoryYField: "category",
        clustered: true
      })
    );

    series.columns.template.setAll({
      tooltipText: `${name} - {categoryY}: {valueX}`,
      height: am5.percent(90),
      width: am5.percent(55),
      strokeOpacity: 0
    });

    // Dynamic color per category + ES shade
    series.columns.template.adapters.add("fill", function (fill, target) {
      const category = target.dataItem.dataContext.category;
      const base = jobBaseColors[category] || "#999";
      return am5.color(shadeColor(base, esShade));
    });

    series.columns.template.adapters.add("stroke", function (stroke, target) {
      const category = target.dataItem.dataContext.category;
      const base = jobBaseColors[category] || "#999";
      return am5.color(shadeColor(base, esShade));
    });

    // Label bullet (value)
    series.bullets.push(function () {
      let label = am5.Label.new(root5, {
        fontSize: 13,
        centerY: am5.percent(50),
        centerX: am5.percent(0),
        fontFamily: "Segoe UI, Tahoma, Geneva, Verdana, sans-serif", // match your header
        fontWeight: "500",
        dx: 1
      });

      label.adapters.add("text", function (text, target) {
        const value = target.dataItem.get("valueX");
        let esLabel = target.dataItem.component.get("name");  // ← gets "EE1", etc.
        return `${value}`;
      });

      label.adapters.add("fill", function (fill, target) {
        const category = target.dataItem.dataContext.category;
        const base = jobBaseColors[category] || "#999";
        return am5.color(shadeColor(base, esShade));
      });

      return am5.Bullet.new(root5, {
        locationX: 1,
        sprite: label
      });
    });

    // Set data + handle 0 values
    series.data.setAll(top8);
    series.events.once("datavalidated", function () {
      am5.array.each(series.dataItems, function (dataItem) {
        if (dataItem.get("valueX") === 0) {
          dataItem.set("valueXWorking", 0.5);
        }
      });
    });
  }

  // Step 5: Create 4 ES series
  makeSeries5("EE1", "EE1");
  makeSeries5("EE2", "EE2");
  makeSeries5("EE3", "EE3");
  makeSeries5("EE4", "EE4");




  // Chart 6: Top 8 entreprises (Bar Chart with Logos)
   // Chart 6: Top 8 Companies (Circle Layout with Logos) - HTML/CSS SolutionMore actions
  // Clear the chart container and replace with HTML
  document.getElementById('chart6').innerHTML = `
    <style>
      .company-grid {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        padding: 20px;
        gap: 15px; /* Reduced gap to prevent excessive spacing */
        width: 100%;
        box-sizing: border-box;
      }

      .company-item {
        display: flex;
        padding-top: 20px;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        cursor: pointer;
        transition: transform 0.2s ease;
        
        flex: 1 1 160px; /* flex-grow, flex-shrink, flex-basis */
        max-width: 25%;   /* Max 5 per row on large screens */
        box-sizing: border-box;
      }

      .company-item:hover {
        transform: scale(1.05);
      }

      .company-circle {
        /* Use percentage-based sizing relative to the parent */
        width: 80%;
        aspect-ratio: 1 / 1; /* Ensure the circle stays circular */
        max-width: 130px; /* Maximum size for larger screens */
        border: 0px solid #8FD2D2;
        border-radius: 50%;
        background: white;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        transition: border-width 0.2s ease;
      }

      .company-item:hover .company-circle {
        border-width: 4px;
      }

      .company-logo {
        max-width: 60%;
        max-height: 60%;
        height: auto;
        object-fit: contain;
      }

      .company-count {
        font-size: clamp(10px, 1.5vw, 16px);
        font-weight: bold;
        color: #0E3F2D;
        margin-bottom: 2px;
        text-align: center;
      }

      .company-percent {
        font-size: clamp(8px, 1.2vw, 13px);
        color: #666666;
        text-align: center;
      }

      .company-name {
        font-size: clamp(8px, 1vw, 12px);
        color: #888888;
        text-align: center;
        margin-top: 5px;
      }

      /* Media queries for better control at different screen sizes */
      @media (max-width: 800px) {
        .company-item {
          width: calc(25% - 15px); /* 4 items per row */
          min-width: 90px;
        }

        .company-circle {
          width: 75%;
          max-width: 100px;
        }
      }

      @media (max-width: 600px) {
        .company-item {
          width: calc(33.33% - 15px); /* 3 items per row */
          min-width: 80px;
        }

        .company-circle {
          width: 70%;
          max-width: 90px;
        }
      }

      @media (max-width: 400px) {
        .company-item {
          width: calc(50% - 15px); /* 2 items per row */
          min-width: 70px;
        }

        .company-circle {
          width: 65%;
          max-width: 80px;
        }
      }
    </style>
    
    <div class="company-grid" id="companyGrid">
      <!-- Companies will be inserted here -->
    </div>
  `;

  // Company data
  // var data6 = [
  //   { company: "Google", value: 120, logo: "https://upload.wikimedia.org/wikipedia/commons/b/b0/Darty.svg" },
  //   { company: "Microsoft", value: 110, logo: "https://www.decathlon.media/app/fo-html/vues/commun/img/commun/logo-decathlon.svg" },
  //   { company: "Amazon", value: 95, logo: "https://upload.wikimedia.org/wikipedia/fr/c/cd/Logo_Auchan_%282015%29.svg" },
  //   { company: "Apple", value: 90, logo: "https://upload.wikimedia.org/wikipedia/fr/3/3b/Logo_Carrefour.svg" },
  //   { company: "Meta", value: 85, logo: "https://upload.wikimedia.org/wikipedia/commons/e/e2/Pernod_Ricard_logo_2019.svg" },
  //   { company: "Netflix", value: 80, logo: "https://upload.wikimedia.org/wikipedia/commons/9/94/AXA_Logo.svg" },
  //   { company: "Tesla", value: 75, logo: "https://upload.wikimedia.org/wikipedia/commons/9/9d/Soci%C3%A9t%C3%A9_G%C3%A9n%C3%A9rale.svg" },
  //   { company: "IBM", value: 70, logo: "https://upload.wikimedia.org/wikipedia/commons/c/c8/Orange_logo.svg" }
  // ];

  // Company datasets per ES
  const datasets6 = {
    EE1: [
      { company: "Darty", value: 0, logo: "https://upload.wikimedia.org/wikipedia/commons/b/b0/Darty.svg" },
      { company: "Decathlon", value: 0, logo: "https://www.decathlon.media/app/fo-html/vues/commun/img/commun/logo-decathlon.svg" },
      { company: "Auchan", value: 0, logo: "https://upload.wikimedia.org/wikipedia/fr/c/cd/Logo_Auchan_%282015%29.svg" },
      { company: "Carrefour", value: 0, logo: "https://upload.wikimedia.org/wikipedia/fr/3/3b/Logo_Carrefour.svg" },
      { company: "Pernod Ricard", value: 0, logo: "https://upload.wikimedia.org/wikipedia/commons/e/e2/Pernod_Ricard_logo_2019.svg" },
      { company: "AXA Assurances", value: 0, logo: "https://upload.wikimedia.org/wikipedia/commons/9/94/AXA_Logo.svg" },
      { company: "Société Générale", value: 0, logo: "https://upload.wikimedia.org/wikipedia/commons/9/9d/Soci%C3%A9t%C3%A9_G%C3%A9n%C3%A9rale.svg" },
      { company: "Orange", value: 0, logo: "https://upload.wikimedia.org/wikipedia/commons/c/c8/Orange_logo.svg" },
      // { company: "Other", value: 0, logo: "https://www.svgrepo.com/show/490660/company.svg" }
    ],
    EE2: [
      { company: "Darty", value: 4, logo: "https://upload.wikimedia.org/wikipedia/commons/b/b0/Darty.svg" },
      { company: "Decathlon", value: 9, logo: "https://www.decathlon.media/app/fo-html/vues/commun/img/commun/logo-decathlon.svg" },
      { company: "Auchan", value: 5, logo: "https://upload.wikimedia.org/wikipedia/fr/c/cd/Logo_Auchan_%282015%29.svg" },
      { company: "Carrefour", value: 4, logo: "https://upload.wikimedia.org/wikipedia/fr/3/3b/Logo_Carrefour.svg" },
      { company: "Pernod Ricard", value: 4, logo: "https://upload.wikimedia.org/wikipedia/commons/e/e2/Pernod_Ricard_logo_2019.svg" },
      { company: "AXA Assurances", value: 5, logo: "https://upload.wikimedia.org/wikipedia/commons/9/94/AXA_Logo.svg" },
      { company: "Société Générale", value: 5, logo: "https://upload.wikimedia.org/wikipedia/commons/9/9d/Soci%C3%A9t%C3%A9_G%C3%A9n%C3%A9rale.svg" },
      { company: "Orange", value: 6, logo: "https://upload.wikimedia.org/wikipedia/commons/c/c8/Orange_logo.svg" },
      // { company: "Other", value: 65, logo: "https://www.svgrepo.com/show/490660/company.svg" }
    ],
    EE3: [
      { company: "Darty", value: 6, logo: "https://upload.wikimedia.org/wikipedia/commons/b/b0/Darty.svg" },
      { company: "Decathlon", value: 11, logo: "https://www.decathlon.media/app/fo-html/vues/commun/img/commun/logo-decathlon.svg" },
      { company: "Auchan", value: 6, logo: "https://upload.wikimedia.org/wikipedia/fr/c/cd/Logo_Auchan_%282015%29.svg" },
      { company: "Carrefour", value: 7, logo: "https://upload.wikimedia.org/wikipedia/fr/3/3b/Logo_Carrefour.svg" },
      { company: "Pernod Ricard", value: 4, logo: "https://upload.wikimedia.org/wikipedia/commons/e/e2/Pernod_Ricard_logo_2019.svg" },
      { company: "AXA Assurances", value: 6, logo: "https://upload.wikimedia.org/wikipedia/commons/9/94/AXA_Logo.svg" },
      { company: "Société Générale", value: 8, logo: "https://upload.wikimedia.org/wikipedia/commons/9/9d/Soci%C3%A9t%C3%A9_G%C3%A9n%C3%A9rale.svg" },
      { company: "Orange", value: 8, logo: "https://upload.wikimedia.org/wikipedia/commons/c/c8/Orange_logo.svg" },
      // { company: "Other", value: 0, logo: "https://www.svgrepo.com/show/490660/company.svg" }
    ],
    EE4: [
      { company: "Darty", value: 6, logo: "https://upload.wikimedia.org/wikipedia/commons/b/b0/Darty.svg" },
      { company: "Decathlon", value: 11, logo: "https://www.decathlon.media/app/fo-html/vues/commun/img/commun/logo-decathlon.svg" },
      { company: "Auchan", value: 8, logo: "https://upload.wikimedia.org/wikipedia/fr/c/cd/Logo_Auchan_%282015%29.svg" },
      { company: "Carrefour", value: 8, logo: "https://upload.wikimedia.org/wikipedia/fr/3/3b/Logo_Carrefour.svg" },
      { company: "Pernod Ricard", value: 7, logo: "https://upload.wikimedia.org/wikipedia/commons/e/e2/Pernod_Ricard_logo_2019.svg" },
      { company: "AXA Assurances", value: 4, logo: "https://upload.wikimedia.org/wikipedia/commons/9/94/AXA_Logo.svg" },
      { company: "Société Générale", value: 7, logo: "https://upload.wikimedia.org/wikipedia/commons/9/9d/Soci%C3%A9t%C3%A9_G%C3%A9n%C3%A9rale.svg" },
      { company: "Orange", value: 9, logo: "https://upload.wikimedia.org/wikipedia/commons/c/c8/Orange_logo.svg" },
      // { company: "Other", value: 0, logo: "https://www.svgrepo.com/show/490660/company.svg" }
    ]
  };

  function renderCompaniesChart(esKey) {
    const data = datasets6[esKey];
    const sorted = [...data].sort((a, b) => b.value - a.value);
    const top8 = sorted.slice(0, 8);

    const topTotal = top8.reduce((sum, item) => sum + item.value, 0);
    const total = 105;
    const percentage = Math.round((topTotal / total) * 100);

    // Update title
    document.getElementById('chart6-title').innerText = `Les 8 premières entreprises : ${topTotal} / ${percentage}%`;

    // Clear previous content
    const companyGrid = document.getElementById('companyGrid');
    companyGrid.innerHTML = "";

    // Add percent to each company
    top8.forEach(company => {
      const companyItem = document.createElement('div');
      companyItem.className = 'company-item';
      const percent = Math.round((company.value / total) * 100);

      companyItem.innerHTML = `
        <div class="company-circle">
          <img src="${company.logo}" alt="${company.company}" class="company-logo" onerror="this.style.display='none'">
        </div>
        <div class="company-count">${company.value}</div>
        <div class="company-percent">${percent}%</div>
        <div class="company-name">${company.company}</div>
      `;

      companyItem.title = `${company.company}: ${company.value} students (${percent}%)`;

      companyItem.addEventListener("click", () => {
        console.log(`Clicked on ${company.company}: ${company.value} students`);
      });

      companyGrid.appendChild(companyItem);
    });
  }

  renderCompaniesChart("EE2"); // Initial render

  document.querySelectorAll(".tab-button6").forEach(button => {
    button.addEventListener("click", () => {
      document.querySelectorAll(".tab-button6").forEach(btn => btn.classList.remove("active"));
      button.classList.add("active");

      const esKey = button.getAttribute("data-tab");
      renderCompaniesChart(esKey);
    });
  });
  
});
</script>
<script>
  function toggleAnalysis(id) {
    const section = document.getElementById(id);
    if (section.style.display === "none" || section.style.display === "") {
      section.style.display = "block";
    } else {
      section.style.display = "none";
    }
  }
</script>

<script>
  // Pie Chart A: Total vs Graduated Students
  am5.ready(function() {
    var rootA = am5.Root.new("pieChartA");
    rootA._logo.dispose();

    rootA.setThemes([am5themes_Animated.new(rootA)]);

    var chartA = rootA.container.children.push(am5percent.PieChart.new(rootA, {
      layout: rootA.verticalLayout,
      innerRadius: am5.percent(50),
    }));

    var seriesA = chartA.series.push(am5percent.PieSeries.new(rootA, {
      valueField: "value",
      categoryField: "category"
    }));

    // Add spacing between slices
    seriesA.slices.template.setAll({
      cornerRadius: 5,
      shiftRadius: 8 // Pull each slice slightly outward
    });

    // Format label with integer percentage
    seriesA.labels.template.setAll({
      text: "{category}: {value} ({valuePercentTotal.formatNumber('#.#')}%)",
      fontSize: 14,
      populateText: true,
      fontWeight: "500",
      fill: am5.color("#333")
    });

    seriesA.slices.template.setAll({
      tooltipText: "{category}: {value} ({valuePercentTotal.formatNumber('#.#')}%)", // Update tooltip to include percentage
      stroke: am5.color("#fff"),
      strokeWidth: 1.5,
      cornerRadius: 6
    });

    seriesA.data.setAll([
      { category: "Diplômé", value: 318 },
      { category: "Non diplômé", value: 383 - 318 }
    ]);

    seriesA.appear(1000, 100);
  });

  // Pie Chart B: Number of Surveys Sent
    am5.ready(function() {
       // Chart chartSent: Niveau managérial (Line Chart)
      const chart4DataLine = [
        { es: "EE1", envoyé: 318,  },
        { es: "EE2", envoyé: 140, },
        { es: "EE3", envoyé: 136, },
        { es: "EE4", envoyé: 131, }
      ];

      function createLineChartManager(containerId, data) {
        const root = am5.Root.new(containerId);
        root._logo.dispose();
        root.setThemes([am5themes_Animated.new(root)]);

        const chart = root.container.children.push(
          am5xy.XYChart.new(root, {
            panX: false,
            panY: false,
            wheelX: "none",
            wheelY: "none",
            layout: root.verticalLayout
          })
        );

        // X Axis (Categories: EE1, EE2...)
        const xAxis = chart.xAxes.push(
          am5xy.CategoryAxis.new(root, {
            categoryField: "es",
            renderer: am5xy.AxisRendererX.new(root, { minGridDistance: 30 }),
            tooltip: am5.Tooltip.new(root, {})
          })
        );
        xAxis.data.setAll(data);

        // Y Axis (Values)
        const yAxis = chart.yAxes.push(
          am5xy.ValueAxis.new(root, {
            renderer: am5xy.AxisRendererY.new(root, {})
          })
        );

        // Line series function
        function createSeries(field, name, color) {
          const series = chart.series.push(
            am5xy.LineSeries.new(root, {
              name: name,
              xAxis: xAxis,
              yAxis: yAxis,
              valueYField: field,
              categoryXField: "es",
              stroke: color,
              fill: color,
              tooltip: am5.Tooltip.new(root, {
                labelText: `envoyé: {valueY}`
              })
            })
          );

          series.strokes.template.setAll({
            strokeWidth: 3
          });

          series.bullets.push(() =>
            am5.Bullet.new(root, {
              sprite: am5.Circle.new(root, {
                radius: 5,
                fill: color,
                stroke: am5.color(0xffffff),
                strokeWidth: 2
              })
            })
          );

          // Add labels above each point
          series.bullets.push(() =>
            am5.Bullet.new(root, {
              locationY: 0,
              sprite: am5.Label.new(root, {
                populateText: true,
                text: "{valueY}", // This now works
                centerY: am5.p100,
                centerX: am5.p60,
                dy: 0,
                fill: color,
                fontWeight: "500",
                fontSize: 14
              })
            })
          );
          series.data.setAll(data);
        }

        // Add "Oui" and "Non" series
        createSeries("envoyé", "envoyé", am5.color("#2A9D8F"));
        // createSeries("Non", "Non", am5.color("#A77A82"));

        chart.set("cursor", am5xy.XYCursor.new(root, {
          behavior: "none",
          xAxis: xAxis,
          yAxis: yAxis
        }));

        chart.appear(1000, 100);
      }

      // Render the chart
      createLineChartManager("chartSent", chart4DataLine);

  });
</script>

<script>
  
am5.ready(function () {

  // France flag based color
  // const manualColorMap = {
  //   // Blues
  //   "FR-BRE": am5.color(0xA3C9F9), // light sky blue
  //   "FR-NOR": am5.color(0x7FB4F3), // medium blue
  //   "FR-HDF": am5.color(0x4F97EA), // strong blue
  //   "FR-GES": am5.color(0x2D76D3), // deep blue

  //   // Whites / Neutral grays
  //   "FR-PDL": am5.color(0xF5F5F5), // near-white
  //   "FR-CVL": am5.color(0xDDDDDD), // very light gray
  //   "FR-IDF": am5.color(0xCCCCCC), // light gray
  //   "FR-BFC": am5.color(0xBBBBBB), // medium-light gray


  //   // Reds
  //   "FR-NAQ": am5.color(0xF7A8A8), // light red
  //   "FR-ARA": am5.color(0xF28585), // medium red
  //   "FR-OCC": am5.color(0xE35D5D), // stronger red
  //   "FR-PAC": am5.color(0xD63A3A),  // deep red
  //   "FR-COR": am5.color(0x8B0000) // sssss
  // };

  // gradient based on bigger smaller size
  const manualColorMap = {
    "FR-PAC": am5.color(0x002F6C), // very dark blue (70)
    "FR-IDF": am5.color(0x174EA6), // dark blue (47)
    "FR-OCC": am5.color(0x2F66C7), // medium-dark blue (45)
    "FR-NAQ": am5.color(0x4785E8), // medium blue (31)
    "FR-GES": am5.color(0x66A2F2), // medium-light blue (30)
    "FR-ARA": am5.color(0x85B9F5), // lighter blue (21)
    "FR-HDF": am5.color(0x9FCBFA), // soft light blue (18)
    "FR-NOR": am5.color(0xB5D9FC), // pale blue (13)
    "FR-BRE": am5.color(0xCDE6FD), // very pale blue (9)
    "FR-PDL": am5.color(0xDEEFFD), // near-white blue (8)
    "FR-CVL": am5.color(0xEDF6FE), // slightly cooler near-white (2)
    "FR-BFC": am5.color(0xDEEFFD), // slightly warmer near-white (2)
    "FR-COR": am5.color(0xEDF6FE)  // light gray (1)
  };

  const manualColorMapSalaries = {
    "FR-IDF": am5.color(0x002F6C), // darkest blue (highest salary)
    "FR-PAC": am5.color(0x174EA6), // very dark blue
    "FR-ARA": am5.color(0x2F66C7), // dark blue
    "FR-NAQ": am5.color(0x4785E8), // medium blue
    "FR-GES": am5.color(0x4785E8), // medium blue
    "FR-OCC": am5.color(0x66A2F2), // light-medium blue
    "FR-BFC": am5.color(0x66A2F2), // light-medium blue
    "FR-PDL": am5.color(0x85B9F5), // pale-medium blue
    "FR-HDF": am5.color(0x9FCBFA), // pale blue
    "FR-BRE": am5.color(0xB5D9FC), // very pale blue
    "FR-NOR": am5.color(0xB5D9FC), // very pale blue
    "FR-COR": am5.color(0xEDF6FE), // no data
    "FR-CVL": am5.color(0xEDF6FE)  // no data
  };

  const regionNames = {
    "FR-BRE": "Bretagne",
    "FR-NOR": "Normandie",
    "FR-HDF": "Hauts-de-France",
    "FR-GES": "Grand Est",
    "FR-PDL": "Pays de la Loire",
    "FR-CVL": "Centre-Val de Loire",
    "FR-IDF": "Île-de-France",
    "FR-BFC": "Bourgogne-Franche-Comté",
    "FR-NAQ": "Nouvelle-Aquitaine",
    "FR-ARA": "Auvergne-Rhône-Alpes",
    "FR-OCC": "Occitanie",
    "FR-PAC": "Provence-Alpes-Côte d'Azur",
    "FR-COR": "Corse"
  };

  function createFranceMap(divId, data, labelField) {
    const root = am5.Root.new(divId);
    root._logo.dispose();
    root.setThemes([am5themes_Animated.new(root)]);

    const chart = root.container.children.push(
      am5map.MapChart.new(root, {
        panX: "none",
        panY: "none",
        wheelY: "none",
        projection: am5map.geoMercator()
      })
    );

    const polygonSeries = chart.series.push(
      am5map.MapPolygonSeries.new(root, {
        geoJSON: am5geodata_franceLow,
        valueField: "value",
        calculateAggregates: true
      })
    );

    polygonSeries.mapPolygons.template.setAll({
      tooltipText: "{name}: {" + labelField + "}",
      interactive: true,
      cursorOverStyle: "pointer"
    });

    // ✨ Enable hover state
    polygonSeries.mapPolygons.template.states.create("hover", {
      fill: am5.color(0xffd700) // golden color or whatever you prefer
    });

    // ✨ Allow color binding via data
    polygonSeries.mapPolygons.template.set("fillField", "fill");

    // polygonSeries.set("heatRules", [{
    //   target: polygonSeries.mapPolygons.template,
    //   dataField: "value",
    //   min: am5.color(0xD6EFFF), // light blue
    //   max: am5.color(0x0033CC), // dark blue
    //   key: "fill"
    // }]);

    polygonSeries.mapPolygons.template.adapters.add("fill", (fill, target) => {
      const dataItem = target.dataItem;
      if (dataItem && dataItem.dataContext && dataItem.dataContext.fill) {
        return dataItem.dataContext.fill;
      }
      return fill;
    });

    // polygonSeries.mapPolygons.template.states.create("hover", {
    //   fill: am5.color(0xffd700), // e.g., golden hover color for contrast
    //   duration: 200
    // });


    const dataItems = Object.entries(data).map(([id, value]) => {
      let numericValue = typeof value === "string"
        ? parseInt(value.replace(/[^\d]/g, ""))
        : value;

      return {
        id,
        value: numericValue,
        [labelField]: value,
        fill: manualColorMap[id] || am5.color(0xd6efff) // default if not specified
      };
    });


    polygonSeries.data.setAll(dataItems);
    chart.appear(1000, 100);
  }

  function createFranceMapSalary(divId, data, labelField) {
    const root = am5.Root.new(divId);
    root._logo.dispose();
    root.setThemes([am5themes_Animated.new(root)]);

    const chart = root.container.children.push(
      am5map.MapChart.new(root, {
        panX: "none",
        panY: "none",
        wheelY: "none",
        projection: am5map.geoMercator()
      })
    );

    const polygonSeries = chart.series.push(
      am5map.MapPolygonSeries.new(root, {
        geoJSON: am5geodata_franceLow,
        valueField: "value",
        calculateAggregates: true
      })
    );

    polygonSeries.mapPolygons.template.setAll({
      tooltipText: "{name}: {" + labelField + "}",
      interactive: true,
      cursorOverStyle: "pointer"
    });

    // ✨ Enable hover state
    polygonSeries.mapPolygons.template.states.create("hover", {
      fill: am5.color(0xffd700) // golden color or whatever you prefer
    });

    // ✨ Allow color binding via data
    polygonSeries.mapPolygons.template.set("fillField", "fill");

    // polygonSeries.set("heatRules", [{
    //   target: polygonSeries.mapPolygons.template,
    //   dataField: "value",
    //   min: am5.color(0xD6EFFF), // light blue
    //   max: am5.color(0x0033CC), // dark blue
    //   key: "fill"
    // }]);

    polygonSeries.mapPolygons.template.adapters.add("fill", (fill, target) => {
      const dataItem = target.dataItem;
      if (dataItem && dataItem.dataContext && dataItem.dataContext.fill) {
        return dataItem.dataContext.fill;
      }
      return fill;
    });

    // polygonSeries.mapPolygons.template.states.create("hover", {
    //   fill: am5.color(0xffd700), // e.g., golden hover color for contrast
    //   duration: 200
    // });


    const dataItems = Object.entries(data).map(([id, value]) => {
      let numericValue = typeof value === "string"
        ? parseInt(value.replace(/[^\d]/g, ""))
        : value;

      return {
        id,
        value: numericValue,
        [labelField]: value,
        fill: manualColorMapSalaries[id] || am5.color(0xd6efff) // default if not specified
      };
    });


    polygonSeries.data.setAll(dataItems);
    chart.appear(1000, 100);
  }

  const studentsData = {
    "FR-PAC": 66, // Provence-Alpes-Côte d'Azur
    "FR-OCC": 41, // Occitanie
    "FR-GES": 34, // Grand Est
    "FR-IDF": 34, // Île-de-France
    "FR-NOR": 33, // Normandie
    "FR-ARA": 31, // Auvergne-Rhône-Alpes
    "FR-HDF": 30, // Hauts-de-France
    "FR-NAQ": 22, // Nouvelle-Aquitaine
    "FR-PDL": 14, // Pays de la Loire
    "FR-BRE": 12, // Bretagne
    "FR-BFC": 1, // Bourgogne-Franche-Comté
    "FR-CVL": 0, // Centre-Val de Loire
    "FR-COR": 0,    // Corse (no data)
  };

  const salaryData = {
    "FR-IDF": '3,100 €',   // Île-de-France
    "FR-PAC": '2,700 €',   // Provence-Alpes-Côte d'Azur
    "FR-ARA": '2,600 €',   // Auvergne-Rhône-Alpes
    "FR-NAQ": '2,500 €',   // Nouvelle-Aquitaine
    "FR-GES": '2,500 €',   // Grand Est
    "FR-OCC": '2,400 €',   // Occitanie
    "FR-BFC": '2,400 €',   // Bourgogne-Franche-Comté
    "FR-PDL": '2,300 €',   // Pays de la Loire
    "FR-HDF": '2,240 €',   // Hauts-de-France
    "FR-BRE": '2,200 €',   // Bretagne
    "FR-NOR": '2,200 €',   // Normandie
    "FR-COR": 'Données non disponibles',   // Corse
    "FR-CVL": 'Données non disponibles',   // Centre-Val de Loire
  };


  function generateLegend(containerId, data, colorMap, labelFormatter) {
    const container = document.getElementById(containerId);
    container.innerHTML = ""; // Clear previous content

    Object.entries(data).forEach(([regionCode, value]) => {
      const color = colorMap[regionCode] || am5.color(0xd6efff);
      const item = document.createElement("div");
      item.className = "legend-item";

      const colorBox = document.createElement("span");
      colorBox.className = "legend-color";
      colorBox.style.backgroundColor = color.toCSSHex();

      const label = document.createElement("span");
      label.className = "legend-label";
      label.textContent = labelFormatter(regionCode, value);

      item.appendChild(colorBox);
      item.appendChild(label);
      container.appendChild(item);
    });
  }

  generateLegend("studentsLegend", studentsData, manualColorMap, (code, value) => `${regionNames[code]}: ${value}`);
  generateLegend("salaryLegend", salaryData, manualColorMapSalaries, (code, value) => `${regionNames[code]}: ${value}`);

  createFranceMap("studentsChart", studentsData, "Étudiants");
  createFranceMapSalary("salaryChart", salaryData, "Salaire (€)");
});

</script>

<script>
// Create root
am5.ready(function () {
  var root = am5.Root.new("pieChart");
  root._logo.dispose();

  // Set themes
  root.setThemes([am5themes_Animated.new(root)]);

  // Create chart
  var chart = root.container.children.push(
    am5percent.PieChart.new(root, {
      layout: root.verticalLayout,
      innerRadius: am5.percent(50),
    })
  );


  // Create series
  var series = chart.series.push(
    am5percent.PieSeries.new(root, {
      name: "Postes",
      valueField: "value",
      categoryField: "category",
      fillField: "color"
    })
  );

  // Set data
  // based on total combination ES 1 - ES 4
  series.data.setAll([
    { category: "Commercial", value: 123, percentage: 42, color: am5.color(0xFFE66D) },
    { category: "Postes non ciblés", value: 68, percentage: 23, color: am5.color(0xFBF0EA) },
    { category: "Autres postes ciblés", value: 23, percentage: 8, color: am5.color(0xE6AA68) },
    { category: "Responsable commercial", value: 14, percentage: 5, color: am5.color(0xBFD8A4) },
    { category: "Conseiller commercial", value: 64, percentage: 22, color: am5.color(0x7FB069) },
  ]);

  // Add labels
  series.labels.template.setAll({
    text: "{category}: {percentage}%",
    fontSize: 14,
    fill: am5.color(0x00454D)
  });

    // Add spacing between slices
  series.slices.template.setAll({
    cornerRadius: 5,
    shiftRadius: 10 // Pull each slice slightly outward
  });

  // Customize slices (optional)
  series.slices.template.setAll({
    stroke: am5.color(0xffffff),
    strokeWidth: 2,
    tooltipText: "{category}: {percentage}%",
  });

}); // end am5.ready()
</script>

<script>
am5.ready(function() {
  var root2 = am5.Root.new("domainePieChart");
  root2._logo.dispose();

  root2.setThemes([am5themes_Animated.new(root2)]);

  var chart2 = root2.container.children.push(
    am5percent.PieChart.new(root2, {
      layout: root2.verticalLayout,
      innerRadius: am5.percent(50),
    })
  );

  var series2 = chart2.series.push(
    am5percent.PieSeries.new(root2, {
      valueField: "value",
      categoryField: "category",
      fillField: "color"
    })
  );

  series2.data.setAll([
    { category: "Immobilier", value: 56, percentage: 19, color: am5.color(0x99D17B) },
    { category: "Commerce", value: 9, percentage: 3, color: am5.color(0x95BF8F) },
    { category: "Assurance", value: 6, percentage: 2, color: am5.color(0xB1AE91) },
    { category: "Autre", value: 223, percentage: 76, color: am5.color(0xFBF0EA) }, 
  ]);

  series2.labels.template.setAll({
    text: "{category}: {percentage}%",
    fontSize: 14,
    fill: am5.color(0x00454D)
  });

  // Add spacing between slices
  series2.slices.template.setAll({
    cornerRadius: 5,
    shiftRadius: 10 // Pull each slice slightly outward
  });

  series2.slices.template.setAll({
    stroke: am5.color(0xffffff),
    strokeWidth: 2,
    tooltipText: "{category}: {percentage}%",
  });
});
</script>

<script>
  am5.ready(function () {
  var rootGender = am5.Root.new("pieChartGender");
  rootGender._logo.dispose();
  rootGender.setThemes([am5themes_Animated.new(rootGender)]);

  var chartGender = rootGender.container.children.push(
    am5percent.PieChart.new(rootGender, {
      layout: rootGender.verticalLayout,
      innerRadius: am5.percent(50),
    })
  );

  var seriesGender = chartGender.series.push(
    am5percent.PieSeries.new(rootGender, {
      valueField: "value",
      categoryField: "category"
    })
  );

  seriesGender.labels.template.set("forceHidden", true);

  seriesGender.slices.template.setAll({
    cornerRadius: 5,
    shiftRadius: 8,
    tooltipText: "{category}: {value} ({percentage}%)",
    stroke: am5.color("#fff"),
    strokeWidth: 1.5,
  });

  const genderData = [
    { category: "Homme", value: 141, percentage: 44 },
    { category: "Femme", value: 177, percentage: 56 }
  ];

  seriesGender.data.setAll(genderData);

  seriesGender.appear(1000, 100);
});


</script>

<script>
  am5.ready(function() {
  var rootGender = am5.Root.new("pieChartStatut");
  rootGender._logo.dispose();

  rootGender.setThemes([am5themes_Animated.new(rootGender)]);

  var chartGender = rootGender.container.children.push(am5percent.PieChart.new(rootGender, {
    layout: rootGender.verticalLayout,
    innerRadius: am5.percent(50),
  }));

  var seriesStatut = chartGender.series.push(am5percent.PieSeries.new(rootGender, {
    valueField: "value",
    categoryField: "category"
  }));

  seriesStatut.labels.template.set("forceHidden", true);

  seriesStatut.slices.template.setAll({
    cornerRadius: 5,
    shiftRadius: 8,
    tooltipText: "{category}: {value} ({percentage}%)",
    stroke: am5.color("#fff"),
    strokeWidth: 1.5,
  });

  seriesStatut.ticks.template.set("visible", false);
  seriesStatut.data.setAll([
    { category: "A un emploi", value: 105, percentage: 33 },
    { category: "Recherche", value: 20, percentage: 6 },
    { category: "Poursuit des études", value: 182, percentage: 57 },
    { category: "Inactif", value: 5, percentage: 2 },
    { category: "Non répondant", value: 6, percentage: 2 }
  ]);

  seriesStatut.appear(1000, 100);
});


</script>

<script>
am5.ready(function () {
  // Create root
  var root = am5.Root.new("pieChartTopSalaries");

  // Set theme
  root.setThemes([
    am5themes_Animated.new(root)
  ]);

  // Create chart
  var chart = root.container.children.push(
    am5percent.PieChart.new(root, {
      layout: root.verticalLayout
    })
  );

  // Create series
  var series = chart.series.push(
    am5percent.PieSeries.new(root, {
      valueField: "value",
      categoryField: "category"
    })
  );

  series.labels.template.set("forceHidden", true);

  series.slices.template.setAll({
    cornerRadius: 5,
    shiftRadius: 8,
    tooltipText: "{category}: {value} € ({valuePercentTotal.formatNumber('#.#')}%)",
    stroke: am5.color("#fff"),
    strokeWidth: 1.5,
    cornerRadius: 6
  });

  // Data for Top 3 Regions by Salary
  const topSalaryData = [
    { category: "Île-de-France", value: 3100 },
    { category: "Provence-Alpes-Côte d'Azur", value: 2700 },
    { category: "Auvergne-Rhône-Alpes", value: 2600 }
  ];
  series.data.setAll(topSalaryData);

  // Create and configure legend
  const legend = am5.Legend.new(root, {
    nameField: "category",
    valueText: "{value} €",
    layout: am5.VerticalLayout.new(root),
    centerX: am5.p50,
    x: am5.p50,
    width: am5.percent(100),
    height: am5.percent(100)
  });

  // Legend appearance improvements
  legend.labels.template.setAll({
    fontSize: 14,               // bigger font
    fontWeight: "600",          // bolder
    fill: am5.color("#222222"), // darker text for contrast
    oversizedBehavior: "wrap",
    paddingTop: 4,
    paddingBottom: 4,
  });

  legend.markers.template.setAll({
    width: 18,   // larger markers
    height: 18,
    cornerRadius: 3,
  });

  legend.items.template.setAll({
    paddingTop: 6,
    paddingBottom: 6,
    gap: 10,
  });

  // Link legend to data
  legend.data.setAll(series.dataItems);

  // Move legend to external container
  const legendContainer = document.getElementById("pieChartTopSalariesLegend");
  legendContainer.style.maxHeight = "200px";      // limit height
  legendContainer.style.overflowY = "auto";       // scroll if too tall
  legendContainer.style.width = "300px";           // fixed width for better layout
  legendContainer.style.background = "#fafafa";    // subtle background to improve visibility
  legendContainer.style.border = "1px solid #ddd"; // subtle border
  legendContainer.style.padding = "10px";          // padding inside

  legendContainer.appendChild(legend.dom);

  // Animate chart
  series.appear(1000, 100);
});
</script>

<script>

var root = am5.Root.new("chartdivSankee");
root._logo.dispose();
// Set themes
// https://www.amcharts.com/docs/v5/concepts/themes/
root.setThemes([am5themes_Animated.new(root)]);

// Create series
// https://www.amcharts.com/docs/v5/charts/flow-charts/
var series = root.container.children.push(
  am5flow.Sankey.new(root, {
    sourceIdField: "from",
    targetIdField: "to",
    valueField: "value",
    paddingRight: 170,
    idField: "id"
  })
);

series.links.template.setAll({ fillStyle: "solid", fillOpacity: 0.15 });

// highlight all links with the same id beginning
series.links.template.events.on("pointerover", function (event) {
  var dataItem = event.target.dataItem;
  var id = dataItem.get("id").split("-")[0];

  am5.array.each(series.dataItems, function (dataItem) {
    if (dataItem.get("id").indexOf(id) != -1) {
      dataItem.get("link").hover();
    }
  });
});

series.links.template.events.on("pointerout", function (event) {
  am5.array.each(series.dataItems, function (dataItem) {
    dataItem.get("link").unhover();
  });
});

// Set data
// https://www.amcharts.com/docs/v5/charts/flow-charts/#Setting_data
series.data.setAll([
  { from: "Diplômé", to: "EE1 Recherche", value: 140, id: "A0-0" },
  { from: "Diplômé", to: "EE1 Poursuit des études", value: 178, id: "A1-0" },

  // ES 1
  { from: "EE1 Recherche", to: "EE2 Non répondant", value: 6, id: "B0-1" },
  { from: "EE1 Recherche", to: "EE2 Inactif", value: 5, id: "B1-1" },
  { from: "EE1 Recherche", to: "EE2 A un emploi", value: 105, id: "B2-1" },
  { from: "EE1 Recherche", to: "EE2 Recherche", value: 20, id: "B3-1" },
  { from: "EE1 Recherche", to: "EE2 Poursuit des études", value: 4, id: "B4-1" },

  { from: "EE1 Poursuit des études", to: "EE2 Poursuit des études", value: 178, id: "C0-1" },

  // ES 2
  { from: "EE2 Non répondant", to: "EE3 Non répondant", value: 6, id: "D0-2" },

  { from: "EE2 Inactif", to: "EE3 Non répondant", value: 2, id: "E0-2" },
  { from: "EE2 Inactif", to: "EE3 Inactif", value: 3, id: "E1-2" },
  
  { from: "EE2 A un emploi", to: "EE3 A un emploi", value: 95, id: "F0-2" },
  { from: "EE2 A un emploi", to: "EE3 Non répondant", value: 10, id: "F1-2" },

  { from: "EE2 Recherche", to: "EE3 Recherche", value: 12, id: "G0-2" },
  { from: "EE2 Recherche", to: "EE3 Poursuit des études", value: 5, id: "G1-2" },
  { from: "EE2 Recherche", to: "EE3 Non répondant", value: 3, id: "G2-2" },

  { from: "EE2 Poursuit des études", to: "EE3 Poursuit des études", value: 182, id: "H0-2" },

  // ES 3
  { from: "EE3 Non répondant", to: "EE4 Non répondant", value: 21, id: "I0-3" },

  { from: "EE3 Inactif", to: "EE4 Inactif", value: 3, id: "J0-3" },

  { from: "EE3 A un emploi", to: "EE4 A un emploi", value: 95, id: "K0-3" },
  
  { from: "EE3 Recherche", to: "EE4 Recherche", value: 4, id: "L0-3" },
  { from: "EE3 Recherche", to: "EE4 Non répondant", value: 4, id: "L1-3" },
  { from: "EE3 Recherche", to: "EE4 Poursuit des études", value: 4, id: "L2-3" },

  { from: "EE3 Poursuit des études", to: "EE4 Poursuit des études", value: 187, id: "M0-3" },

  // ES 4
  { from: "EE4 Non répondant", to: "Fin de l'enquête", value: 25, id: "N0-4" },
  { from: "EE4 Inactif", to: "Fin de l'enquête", value: 3, id: "N1-4" },
  { from: "EE4 A un emploi", to: "Fin de l'enquête", value: 95, id: "N2-4" },
  { from: "EE4 Recherche", to: "Fin de l'enquête", value: 4, id: "N3-4" },
  { from: "EE4 Poursuit des études", to: "Fin de l'enquête", value: 191, id: "N4-4" },

]);

  // series.nodes.labels.template.setAll({
  //   fontSize: 12,
  //   maxWidth: 150,
  //   oversizedBehavior: "wrap",
  //   text: `${ssss}`
  // });

  series.appear(1000, 100);
</script>
</body>
</html>